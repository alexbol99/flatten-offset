!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["flatten-offset"]=e():t["flatten-offset"]=e()}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=39)}([function(t,e,n){"use strict";let i=n(34),{RB_TREE_COLOR_RED:r,RB_TREE_COLOR_BLACK:s}=n(1),o=new i;t.exports=class{constructor(){this.root=null}get size(){let t=0;return this.tree_walk(this.root,()=>t++),t}get keys(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.key.output())),t}get isEmpty(){return null==this.root||this.root==o}insert(t,e=t){if(void 0===t)return;let n=new i(t,e,o,o,null,r);return this.tree_insert(n),this.recalc_max(n),n}exist(t,e){let n=new i(t,e);return!!this.tree_search(this.root,n)}remove(t,e){let n=new i(t,e),r=this.tree_search(this.root,n);return r&&this.tree_delete(r),r}search(t){let e=new i(t),n=[];this.tree_search_interval(this.root,e,n);let r=[];return n.forEach(t=>{t.item.value?r.push(t.item.value):r.push(t.item.key.output())},[]),r}forEach(t){this.tree_walk(this.root,e=>t(e.item.key,e.item.value))}recalc_max(t){let e=t;for(;null!=e.parent;)e.parent.update_max(),e=e.parent}tree_insert(t){let e=this.root,n=null;if(null==this.root||this.root==o)this.root=t;else{for(;e!=o;)n=e,e=t.less_than(e)?e.left:e.right;t.parent=n,t.less_than(n)?n.left=t:n.right=t}this.insert_fixup(t)}insert_fixup(t){let e,n;for(e=t;e!=this.root&&e.parent.color==r;)e.parent==e.parent.parent.left?(n=e.parent.parent.right).color==r?(e.parent.color=s,n.color=s,e.parent.parent.color=r,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=s,e.parent.parent.color=r,this.rotate_right(e.parent.parent)):(n=e.parent.parent.left).color==r?(e.parent.color=s,n.color=s,e.parent.parent.color=r,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=s,e.parent.parent.color=r,this.rotate_left(e.parent.parent));this.root.color=s}tree_delete(t){let e,n;(n=(e=t.left==o||t.right==o?t:this.tree_successor(t)).left!=o?e.left:e.right).parent=e.parent,e==this.root?this.root=n:(e==e.parent.left?e.parent.left=n:e.parent.right=n,e.parent.update_max()),this.recalc_max(n),e!=t&&(t.copy_data(e),t.update_max(),this.recalc_max(t)),e.color==s&&this.delete_fixup(n)}delete_fixup(t){let e,n=t;for(;n!=this.root&&null!=n.parent&&n.color==s;)n==n.parent.left?((e=n.parent.right).color==r&&(e.color=s,n.parent.color=r,this.rotate_left(n.parent),e=n.parent.right),e.left.color==s&&e.right.color==s?(e.color=r,n=n.parent):(e.right.color==s&&(e.color=r,e.left.color=s,this.rotate_right(e),e=n.parent.right),e.color=n.parent.color,n.parent.color=s,e.right.color=s,this.rotate_left(n.parent),n=this.root)):((e=n.parent.left).color==r&&(e.color=s,n.parent.color=r,this.rotate_right(n.parent),e=n.parent.left),e.left.color==s&&e.right.color==s?(e.color=r,n=n.parent):(e.left.color==s&&(e.color=r,e.right.color=s,this.rotate_left(e),e=n.parent.left),e.color=n.parent.color,n.parent.color=s,e.left.color=s,this.rotate_right(n.parent),n=this.root));n.color=s}tree_search(t,e){if(null!=t&&t!=o)return e.equal_to(t)?t:e.less_than(t)?this.tree_search(t.left,e):this.tree_search(t.right,e)}tree_search_interval(t,e,n){null!=t&&t!=o&&(t.left==o||t.not_intersect_left_subtree(e)||this.tree_search_interval(t.left,e,n),t.intersect(e)&&n.push(t),t.right==o||t.not_intersect_right_subtree(e)||this.tree_search_interval(t.right,e,n))}local_minimum(t){let e=t;for(;null!=e.left&&e.left!=o;)e=e.left;return e}local_maximum(t){let e=t;for(;null!=e.right&&e.right!=o;)e=e.right;return e}tree_successor(t){let e,n,i;if(t.right!=o)e=this.local_minimum(t.right);else{for(n=t,i=t.parent;null!=i&&i.right==n;)n=i,i=i.parent;e=i}return e}rotate_left(t){let e=t.right;t.right=e.left,e.left!=o&&(e.left.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,null!=t&&t!=o&&t.update_max(),null!=(e=t.parent)&&e!=o&&e.update_max()}rotate_right(t){let e=t.left;t.left=e.right,e.right!=o&&(e.right.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.right=t,t.parent=e,null!=t&&t!=o&&t.update_max(),null!=(e=t.parent)&&e!=o&&e.update_max()}tree_walk(t,e){null!=t&&t!=o&&(this.tree_walk(t.left,e),e(t),this.tree_walk(t.right,e))}testRedBlackProperty(){let t=!0;return this.tree_walk(this.root,function(e){e.color==r&&(e.left.color==s&&e.right.color==s||(t=!1))}),t}testBlackHeightProperty(t){let e=0,n=0,i=0;if(t.color==s&&e++,(n=t.left!=o?this.testBlackHeightProperty(t.left):1)!=(i=t.right!=o?this.testBlackHeightProperty(t.right):1))throw new Error("Red-black height property violated");return e+=n}}},function(t,e,n){"use strict";t.exports={RB_TREE_COLOR_RED:0,RB_TREE_COLOR_BLACK:1}},function(t,e,n){"use strict";let i=n(0);t.exports=function(t){let{Polygon:e,Point:n,Segment:r,Arc:s,Circle:o,Line:l,Ray:a,Vector:h}=t,{vector:c}=t;t.Distance=class e{static point2point(t,e){return t.distanceTo(e)}static point2line(t,e){let n=t.projectionOn(e);return[c(t,n).length,new r(t,n)]}static point2circle(e,n){let[i,s]=e.distanceTo(n.center);if(t.Utils.EQ_0(i))return[n.r,new r(e,n.toArc().start)];{let t=Math.abs(i-n.r),s=c(n.pc,e).normalize().multiply(n.r),o=n.pc.translate(s);return[t,new r(e,o)]}}static point2segment(n,i){if(i.start.equalTo(i.end))return e.point2point(n,i.start);let s,o,l=new t.Vector(i.start,i.end),a=new t.Vector(i.start,n),h=new t.Vector(i.end,n),c=l.dot(a),f=-l.dot(h);if(t.Utils.GE(c,0)&&t.Utils.GE(f,0)){let t=i.tangentInStart();return s=Math.abs(t.cross(a)),o=i.start.translate(t.multiply(t.dot(a))),[s,new r(n,o)]}return c<0?n.distanceTo(i.start):n.distanceTo(i.end)}static point2arc(n,i){let r,s,o=new t.Circle(i.pc,i.r),l=[];return[r,s]=e.point2circle(n,o),s.end.on(i)&&l.push(e.point2circle(n,o)),l.push(e.point2point(n,i.start)),l.push(e.point2point(n,i.end)),e.sort(l),l[0]}static segment2line(t,n){let i=t.intersect(n);return i.length>0?[0,new r(i[0],i[0])]:(dist_and_segment.push(e.point2line(t.start,n)),dist_and_segment.push(e.point2line(t.end,n)),e.sort(dist_and_segment),dist_and_segment[0])}static segment2segment(t,n){let i=r.intersectSegment2Segment(t,n);if(i.length>0)return[0,new r(i[0],i[0])];let s=[];return s.push(e.point2segment(n.start,t)),s.push(e.point2segment(n.end,t)),s.push(e.point2segment(t.start,n)),s.push(e.point2segment(t.end,n)),e.sort(s),s[0]}static segment2circle(n,i){let s=n.intersect(i);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Line(n.ps,n.pe),[l,a]=e.point2line(i.center,o);if(t.Utils.GE(l,i.r)&&a.end.on(n))return e.point2circle(a.end,i);{let[r,s]=e.point2circle(n.start,i),[o,l]=e.point2circle(n.end,i);return t.Utils.LT(r,o)?[r,s]:[o,l]}}static segment2arc(n,i){let s=n.intersect(i);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Line(n.ps,n.pe),l=new t.Circle(i.pc,i.r),[a,h]=e.point2line(l.center,o);if(t.Utils.GE(a,l.r)&&h.end.on(n)){let[t,n]=e.point2circle(h.end,l);if(n.end.on(i))return[t,n]}let c,f,u=[];return u.push(e.point2arc(n.start,i)),u.push(e.point2arc(n.end,i)),[c,f]=e.point2segment(i.start,n),u.push([c,f.reverse()]),[c,f]=e.point2segment(i.end,n),u.push([c,f.reverse()]),e.sort(u),u[0]}static circle2circle(t,n){let i=t.intersect(n);if(i.length>0)return[0,new r(i[0],i[0])];if(t.center.equalTo(n.center)){let i=t.toArc(),r=n.toArc();return e.point2point(i.start,r.start)}{let i=new l(t.center,n.center),r=i.intersect(t),s=i.intersect(n),o=[];return o.push(e.point2point(r[0],s[0])),o.push(e.point2point(r[0],s[1])),o.push(e.point2point(r[1],s[0])),o.push(e.point2point(r[1],s[1])),e.sort(o),o[0]}}static circle2line(t,n){let i=t.intersect(n);if(i.length>0)return[0,new r(i[0],i[0])];let[s,o]=e.point2line(t.center,n),[l,a]=e.point2circle(o.end,t);return[l,a=a.reverse()]}static arc2line(n,i){let s=i.intersect(n);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Circle(n.center,n.r),[l,a]=e.point2line(o.center,i);if(!t.Utils.GE(l,o.r)){let t=[];return t.push(e.point2line(n.start,i)),t.push(e.point2line(n.end,i)),e.sort(t),t[0]}{let[t,i]=e.point2circle(a.end,o);if(i.end.on(n))return[t,i]}}static arc2circle(n,i){let s=n.intersect(i);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Circle(n.center,n.r),[l,a]=e.circle2circle(o,i);if(a.start.on(n))return[l,a];{let t=[];return t.push(e.point2circle(n.start,i)),t.push(e.point2circle(n.end,i)),e.sort(t),t[0]}}static arc2arc(n,i){let s=n.intersect(i);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Circle(n.center,n.r),l=new t.Circle(i.center,i.r),[a,h]=e.circle2circle(o,l);if(h.start.on(n)&&h.end.on(i))return[a,h];{let t,r,s=[];return[t,r]=e.point2arc(n.start,i),r.end.on(i)&&s.push([t,r]),[t,r]=e.point2arc(n.end,i),r.end.on(i)&&s.push([t,r]),[t,r]=e.point2arc(i.start,n),r.end.on(n)&&s.push([t,r.reverse()]),[t,r]=e.point2arc(i.end,n),r.end.on(n)&&s.push([t,r.reverse()]),[t,r]=e.point2point(n.start,i.start),s.push([t,r]),[t,r]=e.point2point(n.start,i.end),s.push([t,r]),[t,r]=e.point2point(n.end,i.start),s.push([t,r]),[t,r]=e.point2point(n.end,i.end),s.push([t,r]),e.sort(s),s[0]}}static point2polygon(n,i){let s=[Number.POSITIVE_INFINITY,new r];for(let o of i.edges){let[i,l]=o.shape instanceof r?e.point2segment(n,o.shape):e.point2arc(n,o.shape);t.Utils.LT(i,s[0])&&(s=[i,l])}return s}static shape2polygon(e,n){let i=[Number.POSITIVE_INFINITY,new r];for(let r of n.edges){let[n,s]=e.distanceTo(r.shape);t.Utils.LT(n,i[0])&&(i=[n,s])}return i}static polygon2polygon(e,n){let i=[Number.POSITIVE_INFINITY,new t.Segment];for(let r of e.edges)for(let e of n.edges){let[n,s]=r.shape.distanceTo(e.shape);t.Utils.LT(n,i[0])&&(i=[n,s])}return i}static box2box_minmax(t,e){let n=Math.max(Math.max(t.xmin-e.xmax,0),Math.max(e.xmin-t.xmax,0)),i=Math.max(Math.max(t.ymin-e.ymax,0),Math.max(e.ymin-t.ymax,0)),r=n*n+i*i,s=t.merge(e),o=s.xmax-s.xmin,l=s.ymax-s.ymin;return[r,o*o+l*l]}static minmax_tree_process_level(n,i,r,s){let o,l;for(let a of i)[o,l]=e.box2box_minmax(n.box,a.item.key),a.item.value instanceof t.Edge?s.insert([o,l],a.item.value.shape):s.insert([o,l],a.item.value),t.Utils.LT(l,r)&&(r=l);if(0===i.length)return r;let a=i.map(t=>t.left.isNil()?void 0:t.left).filter(t=>void 0!==t),h=i.map(t=>t.right.isNil()?void 0:t.right).filter(t=>void 0!==t),c=[...a,...h].filter(i=>{let[s,o]=e.box2box_minmax(n.box,i.max);return t.Utils.LE(s,r)});return r=e.minmax_tree_process_level(n,c,r,s)}static minmax_tree(t,n,r){let s=new i,o=[n.index.root],l=r<Number.POSITIVE_INFINITY?r*r:Number.POSITIVE_INFINITY;return l=e.minmax_tree_process_level(t,o,l,s),s}static minmax_tree_calc_distance(n,i,r){let s,o;if(null!=i&&!i.isNil()){if([s,o]=e.minmax_tree_calc_distance(n,i.left,r),o)return[s,o];if(t.Utils.LT(s[0],Math.sqrt(i.item.key.low)))return[s,!0];let[l,a]=e.distance(n,i.item.value);return t.Utils.LT(l,s[0])&&(s=[l,a]),[s,o]=e.minmax_tree_calc_distance(n,i.right,s),[s,o]}return[r,!1]}static shape2planarSet(n,i,r=Number.POSITIVE_INFINITY){let s=[r,new t.Segment],o=!1;if(i instanceof t.PlanarSet){let t=e.minmax_tree(n,i,r);[s,o]=e.minmax_tree_calc_distance(n,t.root,s)}return s}static sort(e){e.sort((e,n)=>t.Utils.LT(e[0],n[0])?-1:t.Utils.GT(e[0],n[0])?1:0)}static distance(t,e){return t.distanceTo(e)}}}},function(t,e,n){"use strict";t.exports=function(t){let{Edge:e,Face:n,PlanarSet:i,Box:r}=t,{ray_shoot:s}=t;t.Polygon=class e{constructor(){this.faces=new i,this.edges=new i}get box(){return[...this.faces].reduce((t,e)=>t.merge(e.box),new r)}get vertices(){return[...this.edges].map(t=>t.start)}addFace(...t){let e=new n(this,...t);return this.faces.add(e),e}deleteFace(t){for(let e of t){this.edges.delete(e)}return this.faces.delete(t)}removeChain(t,e,n){if(n.next!==e){for(let i=e;i!==n.next;i=i.next)if(t.remove(this.edges,i),t.isEmpty()){this.deleteFace(t);break}}else this.deleteFace(t)}addVertex(e,n){let i=n.shape.split(e);if(i.length<2)return;let r=new t.Edge(i[0]),s=n.prev;return n.face.insert(this.edges,r,s),this.edges.delete(n),n.shape=i[1],this.edges.add(n),r}reverse(){for(let t of this.faces)t.reverse();return this}clone(){let t=new e;for(let e of this.faces){let n=[];for(let t of e)n.push(t.shape.clone());t.addFace(n)}return t}area(){let t=[...this.faces].reduce((t,e)=>t+e.signedArea(),0);return Math.abs(t)}contains(e){let n=s(this,e);return n==t.INSIDE||n==t.BOUNDARY}distanceTo(e){let{Distance:n}=t;if(e instanceof t.Point){let[t,i]=n.point2polygon(e,this);return[t,i=i.reverse()]}if(e instanceof t.Circle||e instanceof t.Line||e instanceof t.Segment||e instanceof t.Arc){let[t,i]=n.shape2polygon(e,this);return[t,i=i.reverse()]}if(e instanceof t.Polygon){let i,r,s=[Number.POSITIVE_INFINITY,new t.Segment];for(let o of this.edges){let l=s[0];[i,r]=n.shape2planarSet(o.shape,e.edges,l),t.Utils.LT(i,l)&&(s=[i,r])}return s}}isValid(){let t=!0;for(let e of this.faces)if(!e.isSimple(this.edges)){t=!1;break}return t}translate(t){let n=new e;for(let e of this.faces){let i=[];for(let n of e)i.push(n.shape.translate(t));n.addFace(i)}return n}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillRule:r,fillOpacity:s,id:o,className:l}=t,a=o&&o.length>0?`id="${o}"`:"",h=l&&l.length>0?`class="${l}"`:"",c=`\n<path stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"lightcyan"}" fill-rule="${r||"evenodd"}" fill-opacity="${s||1}" ${a} ${h} d="`;for(let t of this.faces)c+=t.svg();return c+='" >\n</path>'}toJSON(){return[...this.faces].map(t=>t.toJSON())}}}},function(t,e,n){"use strict";t.exports=function(t){let{Polygon:e,Point:n,Segment:i,Arc:r,Line:s,Ray:o}=t;t.ray_shoot=function(e,n){let r=void 0;if(e.box.notIntersect(n.box))return t.OUTSIDE;let l=new o(n),a=new s(l.pt,l.norm),h=e.edges.search(l.box);if(0==h.length)return t.OUTSIDE;let c=[];for(let e of h)for(let i of l.intersect(e.shape)){if(i.equalTo(n))return t.BOUNDARY;c.push({pt:i,edge:e})}c.sort((e,n)=>t.Utils.LT(e.pt.x,n.pt.x)?-1:t.Utils.GT(e.pt.x,n.pt.x)?1:0);let f=0;for(let e=0;e<c.length;e++){let n=c[e];if(n.pt.equalTo(n.edge.shape.start)){if(e>0&&n.pt.equalTo(c[e-1].pt)&&n.edge.prev===c[e-1].edge)continue;let t=n.edge.prev.shape.tangentInEnd(),i=n.pt.translate(t),r=n.edge.shape.tangentInStart(),s=n.pt.translate(r),o=i.leftTo(a),l=s.leftTo(a);(o&&!l||!o&&l)&&f++}else if(n.pt.equalTo(n.edge.shape.end)){if(e>0&&n.pt.equalTo(c[e-1].pt)&&n.edge.next===c[e-1].edge)continue;let t=n.edge.next.shape.tangentInStart(),i=n.pt.translate(t),r=n.edge.shape.tangentInEnd(),s=n.pt.translate(r),o=i.leftTo(a),l=s.leftTo(a);(o&&!l||!o&&l)&&f++}else if(n.edge.shape instanceof i)f++;else{let e=n.edge.shape.box;t.Utils.EQ(n.pt.y,e.ymin)||t.Utils.EQ(n.pt.y,e.ymax)||f++}}return r=f%2==1?t.INSIDE:t.OUTSIDE}}},function(t,e,n){"use strict";t.exports=function(t){let{Point:e,Segment:n,Line:i,Circle:r,Arc:s,Box:o,Vector:l}=t;t.Ray=class r{constructor(...n){if(this.pt=new e,0!=n.length)if(1==n.length&&n[0]instanceof e)this.pt=n[0].clone();else{if(2!=n.length||"number"!=typeof n[0]||"number"!=typeof n[1])throw t.Errors.ILLEGAL_PARAMETERS;this.pt=new e(n[0],n[1])}}clone(){return new r(this.pt)}get box(){return new o(this.pt.x,this.pt.y,Number.POSITIVE_INFINITY,this.pt.y)}get start(){return this.pt}get norm(){return new l(0,1)}intersect(t){return t instanceof n?this.intersectRay2Segment(this,t):t instanceof s?this.intersectRay2Arc(this,t):void 0}intersectRay2Segment(e,n){let r=[];if(e.box.notIntersect(n.box))return r;let s=new i(e.start,e.norm),o=s.intersect(n);for(let n of o)t.Utils.GE(n.x,e.start.x)&&r.push(n);return 2==o.length&&1==r.length&&e.start.on(s)&&r.push(e.start),r}intersectRay2Arc(e,n){let r=[];if(e.box.notIntersect(n.box))return r;let s=new i(e.start,e.norm).intersect(n);for(let n of s)t.Utils.GE(n.x,e.start.x)&&r.push(n);return r}},t.ray=((...e)=>new t.Ray(...e))}},function(t,e,n){"use strict";t.exports=function(t){let{Point:e,Segment:n,Arc:i,Box:r,Edge:s}=t;t.Face=class r{constructor(t,...o){if(this.first,this.last,this._box=void 0,this._orientation=void 0,0!=o.length){if(1==o.length)if(o[0]instanceof Array){let s=o[0];if(0==s.length)return;if(s.every(t=>t instanceof e)){let e=r.points2segments(s);this.shapes2face(t.edges,e)}else if(s.every(t=>t instanceof n||t instanceof i))this.shapes2face(t.edges,s);else if(s.every(t=>"segment"===t.name||"arc"===t.name)){let r=[];for(let t of s){let s;s="segment"===t.name?new n(t.ps.x,t.ps.y,t.pe.x,t.pe.y):new i(new e(t.pc.x,t.pc.y),t.r,t.startAngle,t.endAngle,t.counterClockwise),r.push(s)}this.shapes2face(t.edges,r)}}else if(o[0]instanceof r){let e=o[0];this.first=e.first,this.last=e.last;for(let n of e)t.edges.add(n)}2==o.length&&o[0]instanceof s&&o[1]instanceof s&&(this.first=o[0],this.last=o[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}[Symbol.iterator](){let t=void 0;return{next:()=>{let e=t||this.first,n=!this.first||!!t&&t===this.first;return t=e?e.next:void 0,{value:e,done:n}}}}get edges(){let t=[];for(let e of this)t.push(e);return t}get size(){let t=0;for(let e of this)t++;return t}static points2segments(t){let e=[];for(let i=0;i<t.length;i++)e.push(new n(t[i],t[(i+1)%t.length]));return e}shapes2face(t,e){for(let n of e){let e=new s(n);this.append(t,e)}}isEmpty(){return void 0===this.first&&void 0===this.last}append(t,e){void 0===this.first?(e.prev=e,e.next=e,this.first=e,this.last=e,e.arc_length=0):(e.prev=this.last,this.last.next=e,this.last=e,this.last.next=this.first,this.first.prev=this.last,e.arc_length=e.prev.arc_length+e.prev.length),e.face=this,t.add(e)}insert(t,e,n){if(void 0===this.first)edge.prev=e,edge.next=e,this.first=e,this.last=e;else{let t=n.next;n.next=e,t.prev=e,e.prev=n,e.next=t,this.last===n&&(this.first=e)}e.face=this,t.add(e)}remove(t,e){e===this.first&&e===this.last?(this.first=void 0,this.last=void 0):(e.prev.next=e.next,e.next.prev=e.prev,e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)),t.delete(e)}reverse(){let t=[],e=this.last;do{e.shape=e.shape.reverse(),t.push(e),e=e.prev}while(e!==this.last);this.first=void 0,this.last=void 0;for(let e of t)void 0===this.first?(e.prev=e,e.next=e,this.first=e,this.last=e,e.arc_length=0):(e.prev=this.last,this.last.next=e,this.last=e,this.last.next=this.first,this.first.prev=this.last,e.arc_length=e.prev.arc_length+e.prev.length);void 0!==this._orientation&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let t of this)t===this.first?t.arc_length=0:t.arc_length=t.prev.arc_length+t.prev.length,t.face=this}area(){return Math.abs(this.signedArea())}signedArea(){let t=0;for(let e of this)t+=e.shape.definiteIntegral(this.box.ymin);return t}orientation(){if(void 0===this._orientation){let e=this.signedArea();t.Utils.EQ_0(e)?this._orientation=t.ORIENTATION.NOT_ORIENTABLE:t.Utils.LT(e,0)?this._orientation=t.ORIENTATION.CCW:this._orientation=t.ORIENTATION.CW}return this._orientation}get box(){if(void 0===this._box){let e=new t.Box;for(let t of this)e=e.merge(t.box);this._box=e}return this._box}getRelation(e){this.first.bv=this.first.bvStart=this.first.bvEnd=void 0;let n=this.first.setInclusion(e),i=e.faces.search(this.box);if(0===i.length)return n;{let r=new t.Polygon;r.addFace(this);let s=0;for(let e of i){e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(r)===t.INSIDE&&s++}if(n===t.OUTSIDE)return 0===s?t.OUTSIDE:s===i.length&&i.length===e.faces.size?t.CONTAINS:t.INTERLACE;if(n===t.INSIDE)return 0===s?t.INSIDE:t.INTERLACE}}isSimple(t){return 0==r.getSelfIntersections(this,t,!0).length}static getSelfIntersections(e,n,i=!1){let r=[];for(let s of e){let e=n.search(s.box);for(let n of e){if(s===n)continue;if(s.shape instanceof t.Segment&&n.shape instanceof t.Segment&&(s.next===n||s.prev===n))continue;let e=s.shape.intersect(n.shape);for(let t of e)if((!t.equalTo(s.start)||!t.equalTo(n.end)||n!==s.prev)&&(!t.equalTo(s.end)||!t.equalTo(n.start)||n!==s.next)&&(r.push(t),i))break;if(r.length>0&&i)break}if(r.length>0&&i)break}return r}toJSON(){return this.edges.map(t=>t.toJSON())}svg(){let t=`\nM${this.first.start.x},${this.first.start.y}`;for(let e of this)t+=e.svg();return t+=" z"}}}},function(t,e){t.exports=function(t){t.Edge=class{constructor(t){this.shape=t,this.next,this.prev,this.face,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}middle(){return this.shape.middle()}contains(t){return this.shape.contains(t)}setInclusion(e){if(void 0!==this.bv)return this.bv;if(void 0===this.bvStart&&(this.bvStart=t.ray_shoot(e,this.start)),void 0===this.bvEnd&&(this.bvEnd=t.ray_shoot(e,this.end)),this.bvStart===t.OUTSIDE||this.bvEnd==t.OUTSIDE)this.bv=t.OUTSIDE;else if(this.bvStart===t.INSIDE||this.bvEnd==t.INSIDE)this.bv=t.INSIDE;else{let n=t.ray_shoot(e,this.middle());this.bv=n}return this.bv}setOverlap(e){let n=void 0,i=this.shape,r=e.shape;i instanceof t.Segment&&r instanceof t.Segment?i.start.equalTo(r.start)&&i.end.equalTo(r.end)?n=t.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&(n=t.OVERLAP_OPPOSITE):i instanceof t.Arc&&r instanceof t.Arc?i.start.equalTo(r.start)&&i.end.equalTo(r.end)&&i.counterClockwise===r.counterClockwise&&i.middle().equalTo(r.middle())?n=t.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&i.counterClockwise!==r.counterClockwise&&i.middle().equalTo(r.middle())&&(n=t.OVERLAP_OPPOSITE):(i instanceof t.Segment&&r instanceof t.Arc||i instanceof t.Arc&&r instanceof t.Segment)&&(i.start.equalTo(r.start)&&i.end.equalTo(r.end)&&i.middle().equalTo(r.middle())?n=t.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&i.middle().equalTo(r.middle())&&(n=t.OVERLAP_OPPOSITE)),void 0===this.overlap&&(this.overlap=n),void 0===e.overlap&&(e.overlap=n)}svg(){if(this.shape instanceof t.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof t.Arc){let e,n=this.shape,i=n.counterClockwise?"1":"0";if(t.Utils.EQ(n.sweep,2*Math.PI)){let r=n.counterClockwise?1:-1,s=new t.Arc(n.pc,n.r,n.startAngle,n.startAngle+r*Math.PI,n.counterClockwise),o=new t.Arc(n.pc,n.r,n.startAngle+r*Math.PI,n.endAngle,n.counterClockwise);return e="0",` A${s.r},${s.r} 0 ${e},${i} ${s.end.x},${s.end.y}\n                    A${o.r},${o.r} 0 ${e},${i} ${o.end.x},${o.end.y}`}return e=n.sweep<=Math.PI?"0":"1",` A${n.r},${n.r} 0 ${e},${i} ${n.end.x},${n.end.y}`}}toJSON(){let e=this.shape.clone();return e.name=this.shape instanceof t.Segment?"segment":"arc",e}}}},function(t,e,n){"use strict";t.exports=function(t){t.Box=class e{constructor(t,e,n,i){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i}clone(){return new e(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new t.Point(this.xmin,this.ymin)}get high(){return new t.Point(this.xmax,this.ymax)}get max(){return this.clone()}notIntersect(t){return this.xmax<t.xmin||this.xmin>t.xmax||this.ymax<t.ymin||this.ymin>t.ymax}intersect(t){return!this.notIntersect(t)}merge(t){return new e(void 0===this.xmin?t.xmin:Math.min(this.xmin,t.xmin),void 0===this.ymin?t.ymin:Math.min(this.ymin,t.ymin),void 0===this.xmax?t.xmax:Math.max(this.xmax,t.xmax),void 0===this.ymax?t.ymax:Math.max(this.ymax,t.ymax))}less_than(t){return!!this.low.lessThan(t.low)||!(!this.low.equalTo(t.low)||!this.high.lessThan(t.high))}equal_to(t){return this.low.equalTo(t.low)&&this.high.equalTo(t.high)}output(){return this.clone()}maximal_val(t,e){return t.merge(e)}val_less_than(t,e){return t.lessThan(e)}set(t,e,n,i){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,id:r,className:s}=t,o=r&&r.length>0?`id="${r}"`:"",l=s&&s.length>0?`class="${s}"`:"",a=this.xmax-this.xmin,h=this.ymax-this.ymin;return`\n<rect x="${this.xmin}" y="${this.ymin}" width=${a} height=${h} stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" ${o} ${l} />`}}}},function(t,e,n){"use strict";t.exports=function(t){t.Arc=class e{constructor(e=new t.Point,n=1,i=0,r=2*Math.PI,s=!0){this.pc=e.clone(),this.r=n,this.startAngle=i,this.endAngle=r,this.counterClockwise=s}clone(){return new t.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){if(t.Utils.EQ(this.startAngle,this.endAngle))return 0;if(t.Utils.EQ(Math.abs(this.startAngle-this.endAngle),t.PIx2))return t.PIx2;let e;return e=this.counterClockwise?t.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+t.PIx2:t.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+t.PIx2,t.Utils.GT(e,t.PIx2)&&(e-=t.PIx2),t.Utils.LT(e,0)&&(e+=t.PIx2),e}get start(){return new t.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new t.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){let e=this.breakToFunctional().reduce((t,e)=>t.merge(e.start.box),new t.Box);return e=e.merge(this.end.box)}contains(e){if(!t.Utils.EQ(this.pc.distanceTo(e)[0],this.r))return!1;if(e.equalTo(this.start))return!0;let n=new t.Vector(this.pc,e).slope,i=new t.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise);return t.Utils.LE(i.length,this.length)}split(e){if(!this.contains(e))return[];if(t.Utils.EQ_0(this.sweep))return[this.clone()];if(this.start.equalTo(e)||this.end.equalTo(e))return[this.clone()];let n=new t.Vector(this.pc,e).slope;return[new t.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise),new t.Arc(this.pc,this.r,n,this.endAngle,this.counterClockwise)]}middle(){let e=this.counterClockwise===t.CCW?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new t.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(n){return n instanceof t.Line?n.intersect(this):n instanceof t.Circle?e.intersectArc2Circle(this,n):n instanceof t.Segment?n.intersect(this):n instanceof t.Arc?e.intersectArc2Arc(this,n):void 0}distanceTo(e){let{Distance:n}=t;if(e instanceof t.Point){let[t,i]=n.point2arc(e,this);return[t,i=i.reverse()]}if(e instanceof t.Circle){let[t,i]=n.arc2circle(this,e);return[t,i]}if(e instanceof t.Line){let[t,i]=n.arc2line(this,e);return[t,i]}if(e instanceof t.Segment){let[t,i]=n.segment2arc(e,this);return[t,i=i.reverse()]}if(e instanceof t.Arc){let[t,i]=n.arc2arc(this,e);return[t,i]}if(e instanceof t.Polygon){let[t,i]=n.shape2polygon(this,e);return[t,i]}if(e instanceof t.PlanarSet){let[t,i]=n.shape2planarSet(this,e);return[t,i]}}breakToFunctional(){let e=[],n=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],i=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],r=[];for(let e=0;e<4;e++)i[e].on(this)&&r.push(new t.Arc(this.pc,this.r,this.startAngle,n[e],this.counterClockwise));if(0==r.length)e.push(this.clone());else{r.sort((t,e)=>t.length-e.length);for(let n=0;n<r.length;n++){let i,s=e.length>0?e[e.length-1]:void 0;i=s?new t.Arc(this.pc,this.r,s.endAngle,r[n].endAngle,this.counterClockwise):new t.Arc(this.pc,this.r,this.startAngle,r[n].endAngle,this.counterClockwise),t.Utils.EQ_0(i.length)||e.push(i.clone())}let n,i=e.length>0?e[e.length-1]:void 0;n=i?new t.Arc(this.pc,this.r,i.endAngle,this.endAngle,this.counterClockwise):new t.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),t.Utils.EQ_0(n.length)||e.push(n.clone())}return e}tangentInStart(){let e=new t.Vector(this.pc,this.start),n=this.counterClockwise?Math.PI/2:-Math.PI/2;return e.rotate(n).normalize()}tangentInEnd(){let e=new t.Vector(this.pc,this.end),n=this.counterClockwise?-Math.PI/2:Math.PI/2;return e.rotate(n).normalize()}reverse(){return new e(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(t){let e=this.clone();return e.pc=this.pc.translate(t),e}static intersectArc2Arc(e,n){var i=[];if(e.box.notIntersect(n.box))return i;if(e.pc.equalTo(n.pc)&&t.Utils.EQ(e.r,n.r)){let t;return(t=e.start).on(n)&&i.push(t),(t=e.end).on(n)&&i.push(t),(t=n.start).on(e)&&i.push(t),(t=n.end).on(e)&&i.push(t),i}let r=new t.Circle(e.pc,e.r),s=new t.Circle(n.pc,n.r),o=r.intersect(s);for(let t of o)t.on(e)&&t.on(n)&&i.push(t);return i}static intersectArc2Circle(e,n){let i=[];if(e.box.notIntersect(n.box))return i;if(n.pc.equalTo(e.pc)&&t.Utils.EQ(n.r,e.r))return i.push(e.start),i.push(e.end),i;let r=n,s=new t.Circle(e.pc,e.r),o=r.intersect(s);for(let t of o)t.on(e)&&i.push(t);return i}definiteIntegral(t=0){return this.breakToFunctional().reduce((e,n)=>e+n.circularSegmentDefiniteIntegral(t),0)}circularSegmentDefiniteIntegral(e){let n=new t.Line(this.start,this.end),i=this.pc.leftTo(n),r=new t.Segment(this.start,this.end).definiteIntegral(e),s=this.circularSegmentArea();return i?r-s:r+s}circularSegmentArea(){return.5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}svg(e={}){let n=this.sweep<=Math.PI?"0":"1",i=this.counterClockwise?"1":"0",{stroke:r,strokeWidth:s,fill:o,id:l,className:a}=e,h=l&&l.length>0?`id="${l}"`:"",c=a&&a.length>0?`class="${a}"`:"";if(t.Utils.EQ(this.sweep,2*Math.PI)){return new t.Circle(this.pc,this.r).svg(e)}return`\n<path d="M${this.start.x},${this.start.y}\n                             A${this.r},${this.r} 0 ${n},${i} ${this.end.x},${this.end.y}"\n                    stroke="${r||"black"}" stroke-width="${s||1}" fill="${o||"none"}" ${h} ${c} />`}},t.arc=((...e)=>new t.Arc(...e))}},function(t,e,n){"use strict";t.exports=function(t){t.Segment=class e{constructor(...e){if(this.ps=new t.Point,this.pe=new t.Point,0!=e.length){if(1==e.length&&e[0]instanceof Array&&4==e[0].length){let n=e[0];return this.ps=new t.Point(n[0],n[1]),void(this.pe=new t.Point(n[2],n[3]))}if(2==e.length&&e[0]instanceof t.Point&&e[1]instanceof t.Point)return this.ps=e[0].clone(),void(this.pe=e[1].clone());if(4==e.length)return this.ps=new t.Point(e[0],e[1]),void(this.pe=new t.Point(e[2],e[3]));throw t.Errors.ILLEGAL_PARAMETERS}}clone(){return new t.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new t.Vector(this.start,this.end).slope}get box(){return new t.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}contains(e){return t.Utils.EQ_0(this.distanceToPoint(e))}intersect(n){return n instanceof t.Line?e.intersectSegment2Line(this,n):n instanceof t.Segment?e.intersectSegment2Segment(this,n):n instanceof t.Circle?e.intersectSegment2Circle(this,n):n instanceof t.Arc?e.intersectSegment2Arc(this,n):void 0}distanceTo(e){let{Distance:n}=t;if(e instanceof t.Point){let[t,i]=n.point2segment(e,this);return[t,i=i.reverse()]}if(e instanceof t.Circle){let[t,i]=n.segment2circle(this,e);return[t,i]}if(e instanceof t.Line){let[t,i]=n.segment2line(this,e);return[t,i]}if(e instanceof t.Segment){let[t,i]=n.segment2segment(this,e);return[t,i]}if(e instanceof t.Arc){let[t,i]=n.segment2arc(this,e);return[t,i]}if(e instanceof t.Polygon){let[t,i]=n.shape2polygon(this,e);return[t,i]}if(e instanceof t.PlanarSet){let[t,i]=n.shape2planarSet(this,e);return[t,i]}}tangentInStart(){return new t.Vector(this.start,this.end).normalize()}tangentInEnd(){return new t.Vector(this.end,this.start).normalize()}reverse(){return new e(this.end,this.start)}split(e){return this.contains(e)?this.start.equalTo(this.end)?[this.clone()]:this.start.equalTo(e)||this.end.equalTo(e)?[this]:[new t.Segment(this.start,e),new t.Segment(e,this.end)]:[]}middle(){return new t.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}distanceToPoint(e){let[n,...i]=t.Distance.point2segment(e,this);return n}definiteIntegral(t=0){return(this.end.x-this.start.x)*(this.start.y-t+(this.end.y-t))/2}translate(t){return new e(this.ps.translate(t),this.pe.translate(t))}static intersectSegment2Line(e,n){let i=[],r=t.Utils.EQ_0(e.length);return e.ps.on(n)&&i.push(e.ps),e.pe.on(n)&&!r&&i.push(e.pe),i.length>0?i:e.ps.leftTo(n)&&e.pe.leftTo(n)||!e.ps.leftTo(n)&&!e.pe.leftTo(n)?i:new t.Line(e.ps,e.pe).intersect(n)}static intersectSegment2Segment(e,n){let i=[];if(e.box.notIntersect(n.box))return i;let r=new t.Line(e.ps,e.pe),s=new t.Line(n.ps,n.pe);if(r.incidentTo(s))e.ps.on(n)&&i.push(e.ps),e.pe.on(n)&&i.push(e.pe),!n.ps.on(e)||n.ps.equalTo(e.ps)||n.ps.equalTo(e.pe)||i.push(n.ps),!n.pe.on(e)||n.pe.equalTo(e.ps)||n.pe.equalTo(e.pe)||i.push(n.pe);else{let t=r.intersect(s);t.length>0&&t[0].on(e)&&t[0].on(n)&&i.push(t[0])}return i}static intersectSegment2Circle(e,n){let i=[];if(e.box.notIntersect(n.box))return i;let r=new t.Line(e.ps,e.pe).intersect(n);for(let t of r)t.on(e)&&i.push(t);return i}static intersectSegment2Arc(e,n){let i=[];if(e.box.notIntersect(n.box))return i;let r=new t.Line(e.ps,e.pe),s=new t.Circle(n.pc,n.r),o=r.intersect(s);for(let t of o)t.on(e)&&t.on(n)&&i.push(t);return i}svg(t={}){let{stroke:e,strokeWidth:n,id:i,className:r}=t,s=i&&i.length>0?`id="${i}"`:"",o=r&&r.length>0?`class="${r}"`:"";return`\n<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" stroke="${e||"black"}" stroke-width="${n||1}" ${s} ${o} />`}},t.segment=((...e)=>new t.Segment(...e))}},function(t,e,n){"use strict";t.exports=function(t){let{Arc:e,vector:n}=t;t.Circle=class e{constructor(t,e){this.pc=t,this.r=e}clone(){return new t.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new t.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(e){return t.Utils.LE(e.distanceTo(this.center)[0],this.r)}toArc(e=!0){return new t.Arc(this.center,this.r,Math.PI,-Math.PI,e)}intersect(n){return n instanceof t.Line?n.intersect(this):n instanceof t.Segment?n.intersect(this):n instanceof t.Circle?e.intersectCirle2Circle(this,n):n instanceof t.Arc?n.intersect(this):void 0}distanceTo(e){let{Distance:n}=t,{point2circle:i,circle2circle:r,circle2line:s,segment2circle:o,arc2circle:l}=n;if(e instanceof t.Point){let[t,n]=i(e,this);return[t,n=n.reverse()]}if(e instanceof t.Circle){let[t,n]=r(this,e);return[t,n]}if(e instanceof t.Line){let[t,n]=s(this,e);return[t,n]}if(e instanceof t.Segment){let[t,n]=o(e,this);return[t,n=n.reverse()]}if(e instanceof t.Arc){let[t,n]=l(e,this);return[t,n=n.reverse()]}if(e instanceof t.Polygon){let[t,i]=n.shape2polygon(this,e);return[t,i]}if(e instanceof t.PlanarSet){let[t,i]=n.shape2planarSet(this,e);return[t,i]}}static intersectCirle2Circle(e,n){let i=[];if(e.box.notIntersect(n.box))return i;let r=new t.Vector(e.pc,n.pc),s=e.r,o=n.r;if(t.Utils.EQ_0(s)||t.Utils.EQ_0(o))return i;if(t.Utils.EQ_0(r.x)&&t.Utils.EQ_0(r.y)&&t.Utils.EQ(s,o))return i.push(e.pc.translate(-s,0)),i;let l,a=e.pc.distanceTo(n.pc)[0];if(t.Utils.GT(a,s+o))return i;if(t.Utils.LT(a,Math.abs(s-o)))return i;if(r.x/=a,r.y/=a,t.Utils.EQ(a,s+o)||t.Utils.EQ(a,Math.abs(s-o)))return l=e.pc.translate(s*r.x,s*r.y),i.push(l),i;let h=s*s/(2*a)-o*o/(2*a)+a/2,c=e.pc.translate(h*r.x,h*r.y),f=Math.sqrt(s*s-h*h);return l=c.translate(r.rotate90CCW().multiply(f)),i.push(l),l=c.translate(r.rotate90CW().multiply(f)),i.push(l),i}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillOpacity:r,id:s,className:o}=t,l=s&&s.length>0?`id="${s}"`:"",a=o&&o.length>0?`class="${o}"`:"";return`\n<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}" stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${r||1}" ${l} ${a} />`}},t.circle=((...e)=>new t.Circle(...e))}},function(t,e,n){"use strict";t.exports=function(t){t.Line=class e{constructor(...n){if(this.pt=new t.Point,this.norm=new t.Vector(0,1),0!=n.length){if(2==n.length){let i=n[0],r=n[1];if(i instanceof t.Point&&r instanceof t.Point)return this.pt=i,void(this.norm=e.points2norm(i,r));if(i instanceof t.Point&&r instanceof t.Vector){if(t.Utils.EQ_0(r.x)&&t.Utils.EQ_0(r.y))throw t.Errors.ILLEGAL_PARAMETERS;return this.pt=i.clone(),void(this.norm=r.clone())}if(i instanceof t.Vector&&r instanceof t.Point){if(t.Utils.EQ_0(i.x)&&t.Utils.EQ_0(i.y))throw t.Errors.ILLEGAL_PARAMETERS;return this.pt=r.clone(),void(this.norm=i.clone())}}throw t.Errors.ILLEGAL_PARAMETERS}}clone(){return new t.Line(this.pt,this.norm)}get slope(){return new t.Vector(this.norm.y,-this.norm.x).slope}get standard(){return[this.norm.x,this.norm.y,this.norm.dot(this.pt)]}parallelTo(e){return t.Utils.EQ_0(this.norm.cross(e.norm))}incidentTo(t){return(this.norm.equalTo(t.norm)||this.norm.equalTo(t.norm.invert()))&&this.pt.on(t)}contains(e){if(this.pt.equalTo(e))return!0;let n=new t.Vector(this.pt,e);return t.Utils.EQ_0(this.norm.dot(n))}intersect(n){return n instanceof t.Line?e.intersectLine2Line(this,n):n instanceof t.Circle?e.intersectLine2Circle(this,n):n instanceof t.Segment?n.intersect(this):n instanceof t.Arc?e.intersectLine2Arc(this,n):void 0}distanceTo(e){let{Distance:n}=t;if(e instanceof t.Point){let[t,i]=n.point2line(e,this);return[t,i=i.reverse()]}if(e instanceof t.Circle){let[t,i]=n.circle2line(e,this);return[t,i=i.reverse()]}if(e instanceof t.Segment){let[t,i]=n.segment2line(e,this);return[t,i.reverse()]}if(e instanceof t.Arc){let[t,i]=n.arc2line(e,this);return[t,i.reverse()]}if(e instanceof t.Polygon){let[t,i]=n.shape2polygon(this,e);return[t,i]}}svg(n,i={}){let r=e.intersectLine2Box(this,n);if(0===r.length)return"";let s=r[0],o=2==r.length?r[1]:r.find(t=>!t.equalTo(s));return void 0===o&&(o=s),new t.Segment(s,o).svg(i)}static points2norm(e,n){if(e.equalTo(n))throw t.Errors.ILLEGAL_PARAMETERS;return new t.Vector(e,n).normalize().rotate90CCW()}static intersectLine2Line(e,n){let i=[],[r,s,o]=e.standard,[l,a,h]=n.standard,c=r*a-s*l,f=o*a-s*h,u=r*h-o*l;if(!t.Utils.EQ_0(c)){let e=new t.Point(f/c,u/c);i.push(e)}return i}static intersectLine2Circle(e,n){let i=[],r=n.pc.projectionOn(e),s=n.pc.distanceTo(r)[0];if(t.Utils.EQ(s,n.r))i.push(r);else if(t.Utils.LT(s,n.r)){var o,l,a=Math.sqrt(n.r*n.r-s*s);o=e.norm.rotate90CCW().multiply(a),l=r.translate(o),i.push(l),o=e.norm.rotate90CW().multiply(a),l=r.translate(o),i.push(l)}return i}static intersectLine2Box(e,n){let i=[new t.Point(n.xmin,n.ymin),new t.Point(n.xmax,n.ymin),new t.Point(n.xmax,n.ymax),new t.Point(n.xmin,n.ymax)],r=[new t.Segment(i[0],i[1]),new t.Segment(i[1],i[2]),new t.Segment(i[2],i[3]),new t.Segment(i[3],i[0])],s=[];for(let t of r){let n=t.intersect(e);for(let t of n)s.push(t)}return s}static intersectLine2Arc(n,i){let r=[];if(0==e.intersectLine2Box(n,i.box).length)return r;let s=new t.Circle(i.pc,i.r),o=n.intersect(s);for(let t of o)t.on(i)&&r.push(t);return r}},t.line=((...e)=>new t.Line(...e))}},function(t,e,n){"use strict";t.exports=function(t){t.Vector=class e{constructor(...e){if(this.x=0,this.y=0,0!=e.length){if(2==e.length){let n=e[0],i=e[1];if("number"==typeof n&&"number"==typeof i)return this.x=n,void(this.y=i);if(n instanceof t.Point&&i instanceof t.Point)return this.x=i.x-n.x,void(this.y=i.y-n.y)}throw t.Errors.ILLEGAL_PARAMETERS}}clone(){return new e(this.x,this.y)}get slope(){let t=Math.atan2(this.y,this.x);return t<0&&(t=2*Math.PI+t),t}get length(){return Math.sqrt(this.dot(this))}equalTo(e){return t.Utils.EQ(this.x,e.x)&&t.Utils.EQ(this.y,e.y)}multiply(t){return new e(t*this.x,t*this.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}normalize(){if(!t.Utils.EQ_0(this.length))return new e(this.x/this.length,this.y/this.length);throw t.Errors.ZERO_DIVISION}rotate(e){let n=new t.Point(this.x,this.y).rotate(e);return new t.Vector(n.x,n.y)}rotate90CCW(){return new t.Vector(-this.y,this.x)}rotate90CW(){return new t.Vector(this.y,-this.x)}invert(){return new t.Vector(-this.x,-this.y)}},t.vector=((...e)=>new t.Vector(...e))}},function(t,e){t.exports=function(t){t.Point=class e{constructor(t=0,e=0){this.x=Number.isNaN(t)?0:t,this.y=Number.isNaN(e)?0:e}get box(){return new t.Box(this.x,this.y,this.x,this.y)}clone(){return new t.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(e){return t.Utils.EQ(this.x,e.x)&&t.Utils.EQ(this.y,e.y)}lessThan(e){return!!t.Utils.LT(this.y,e.y)||!(!t.Utils.EQ(this.y,e.y)||!t.Utils.LT(this.x,e.x))}rotate(e,n={x:0,y:0}){var i=n.x+(this.x-n.x)*Math.cos(e)-(this.y-n.y)*Math.sin(e),r=n.y+(this.x-n.x)*Math.sin(e)+(this.y-n.y)*Math.cos(e);return new t.Point(i,r)}translate(...e){if(1==e.length&&e[0]instanceof t.Vector)return new t.Point(this.x+e[0].x,this.y+e[0].y);if(2==e.length&&"number"==typeof e[0]&&"number"==typeof e[1])return new t.Point(this.x+e[0],this.y+e[1]);throw t.Errors.ILLEGAL_PARAMETERS}projectionOn(e){if(this.equalTo(e.pt))return this.clone();let n=new t.Vector(this,e.pt);if(t.Utils.EQ_0(n.cross(e.norm)))return e.pt.clone();let i=n.dot(e.norm),r=e.norm.multiply(i);return this.translate(r)}leftTo(e){let n=new t.Vector(e.pt,this);return t.Utils.GT(n.dot(e.norm),0)}distanceTo(n){let{Distance:i}=t;if(n instanceof e){let e=n.x-this.x,i=n.y-this.y;return[Math.sqrt(e*e+i*i),new t.Segment(this,n)]}return n instanceof t.Line?i.point2line(this,n):n instanceof t.Circle?i.point2circle(this,n):n instanceof t.Segment?i.point2segment(this,n):n instanceof t.Arc?i.point2arc(this,n):n instanceof t.Polygon?i.point2polygon(this,n):n instanceof t.PlanarSet?i.shape2planarSet(this,n):void 0}on(e){return e instanceof t.Point?this.equalTo(e):e instanceof t.Line?e.contains(this):e instanceof t.Circle?e.contains(this):e instanceof t.Segment?e.contains(this):e instanceof t.Arc?e.contains(this):e instanceof t.Polygon?e.contains(this):void 0}svg(t={}){let{r:e,stroke:n,strokeWidth:i,fill:r,id:s,className:o}=t,l=s&&s.length>0?`id="${s}"`:"",a=o&&o.length>0?`class="${o}"`:"";return`\n<circle cx="${this.x}" cy="${this.y}" r="${e||3}" stroke="${n||"black"}" stroke-width="${i||1}" fill="${r||"red"}" ${l} ${a} />`}},t.point=((...e)=>new t.Point(...e))}},function(t,e,n){"use strict";let i=n(0);t.exports=function(t){t.PlanarSet=class extends Set{constructor(){super(),this.index=new i}add(t){let e=this.size;if(super.add(t),this.size>e){this.index.insert(t.box,t)}return this}delete(t){let e=super.delete(t);return e&&this.index.remove(t.box,t),e}clear(){}search(t){return this.index.search(t)}hit(e){let n=new t.Box(e.x-1,e.y-1,e.x+1,e.y+1);return this.index.search(n).filter(t=>e.on(t))}svg(){return[...this].reduce((t,e)=>t+e.svg(),"")}}}},function(t,e){t.exports={ILLEGAL_PARAMETERS:new ReferenceError("Illegal Parameters"),ZERO_DIVISION:new Error("Zero division")}},function(t,e){t.exports={DP_TOL:1e-6,EQ_0:function(t){return t<1e-6&&t>-1e-6},EQ:function(t,e){return t-e<1e-6&&t-e>-1e-6},GT:(t,e)=>t-e>1e-6,GE:(t,e)=>t-e>-1e-6,LT:(t,e)=>t-e<-1e-6,LE:(t,e)=>t-e<1e-6}},function(t,e,n){"use strict";let i=n(17),r=n(16),s=new class{constructor(){this.DP_TOL=i.DP_TOL,this.CCW=!0,this.CW=!1,this.ORIENTATION={CCW:-1,CW:1,NOT_ORIENTABLE:0},this.PIx2=2*Math.PI,this.PI_2=.5*Math.PI,this.Utils=i,this.Errors=r,this.INSIDE=1,this.OUTSIDE=0,this.BOUNDARY=2,this.CONTAINS=3,this.INTERLACE=4,this.CLIP_INSIDE=1,this.CLIP_OUTSIDE=0,this.BOOLEAN_UNION=1,this.BOOLEAN_INTERSECT=2,this.BOOLEAN_SUBTRACT=3,this.OVERLAP_SAME=1,this.OVERLAP_OPPOSITE=2}};n(15)(s),n(14)(s),n(13)(s),n(12)(s),n(11)(s),n(10)(s),n(9)(s),n(8)(s),n(7)(s),n(6)(s),n(5)(s),n(4)(s),n(3)(s),n(2)(s),t.exports=s},function(t,e,n){"use strict";let i=n(18),{Polygon:r,Segment:s,Arc:o}=i;const l=0,a=1,h=2;class c{static booleanOp(t){let e=new r;for(let[n,i]of t)e=c.booleanOpBinary(e,n,i);return e}static booleanOpBinary(t,e,n){return c.clip(t,e,n)}static unify(t,e){return c.booleanOpBinary(t,e,i.BOOLEAN_UNION)}static subtract(t,e){let n=e.clone().reverse();return c.booleanOpBinary(t,n,i.BOOLEAN_SUBTRACT)}static intersect(t,e){return c.booleanOpBinary(t,e,i.BOOLEAN_INTERSECT)}static arrange(t,e){let n=c.getIntersections(t,e);c.sortIntersections(n),c.splitByIntersections(t,n.int_points1_sorted),c.splitByIntersections(e,n.int_points2_sorted)}static clip(t,e,n){let i=t.clone(),r=e.clone(),s=c.getIntersections(i,r);return c.sortIntersections(s),c.splitByIntersections(i,s.int_points1_sorted),c.splitByIntersections(r,s.int_points2_sorted),c.filterDuplicatedIntersections(s),c.removeNotRelevantNotIntersectedFaces(i,r,n,s.int_points1,!0),c.removeNotRelevantNotIntersectedFaces(r,i,n,s.int_points2,!1),c.initializeInclusionFlags(s.int_points1),c.initializeInclusionFlags(s.int_points2),c.calculateInclusionFlags(s.int_points1,e),c.calculateInclusionFlags(s.int_points2,t),c.setOverlappingFlags(s),c.removeNotRelevantChains(i,n,s.int_points1_sorted,!0),c.removeNotRelevantChains(r,n,s.int_points2_sorted,!1),c.copyWrkToRes(i,r,n,s.int_points2),c.swapLinks(i,r,s),c.removeOldFaces(i,s.int_points1),c.removeOldFaces(r,s.int_points2),c.restoreFaces(i,s.int_points1,s.int_points2),c.restoreFaces(i,s.int_points2,s.int_points1),i}static getIntersections(t,e){let n={int_points1:[],int_points2:[]};for(let i of t.edges){let t=e.edges.search(i.box);for(let e of t){let t=i.shape.intersect(e.shape);for(let r of t)c.addToIntPoints(i,r,n.int_points1),c.addToIntPoints(e,r,n.int_points2)}}return n}static addToIntPoints(t,e,n){let r=n.length,s=t.shape.split(e);if(0===s.length)return;let o=0;1===s.length?t.shape.start.equalTo(e)?o=0:t.shape.end.equalTo(e)&&(o=t.shape.length):o=s[0].length;let c=l;i.Utils.EQ(o,0)&&(c|=a),i.Utils.EQ(o,t.shape.length)&&(c|=h);let f=c&h&&0===t.next.arc_length?0:t.arc_length+o;n.push({id:r,pt:e,arc_length:f,edge_before:t,edge_after:void 0,face:t.face,is_vertex:c})}static sortIntersections(t){0!==t.int_points1.length&&(t.int_points1_sorted=c.getSortedArray(t.int_points1),t.int_points2_sorted=c.getSortedArray(t.int_points2))}static getSortedArray(t){let e=new Map,n=0;for(let i of t)e.has(i.face)||(e.set(i.face,n),n++);for(let n of t)n.faceId=e.get(n.face);return t.slice().sort(c.compareFn)}static compareFn(t,e){return t.faceId<e.faceId?-1:t.faceId>e.faceId?1:i.Utils.LT(t.arc_length,e.arc_length)?-1:i.Utils.GT(t.arc_length,e.arc_length)?1:0}static splitByIntersections(t,e){let{Polygon:n,Segment:r,Arc:s}=i;if(e){for(let n of e){let e=n.edge_before;if(e.shape.start.equalTo(n.pt)&&(n.is_vertex|=a),e.shape.end.equalTo(n.pt)&&(n.is_vertex|=h),n.is_vertex&a){n.edge_before=e.prev,n.is_vertex=h;continue}if(n.is_vertex&h)continue;let i=t.addVertex(n.pt,e);n.edge_before=i}for(let t of e)t.edge_after=t.edge_before.next}}static filterDuplicatedIntersections(t){if(t.int_points1.length<2)return;let e=!1,n=t.int_points1_sorted[0],r=t.int_points2[n.id];for(let s=1;s<t.int_points1_sorted.length;s++){let o=t.int_points1_sorted[s];if(!i.Utils.EQ(o.arc_length,n.arc_length)){n=o,r=t.int_points2[n.id];continue}let l=t.int_points2[o.id];o.edge_before===n.edge_before&&o.edge_after===n.edge_after&&l.edge_before===r.edge_before&&l.edge_after===r.edge_after&&(o.id=-1,l.id=-1,e=!0)}r=t.int_points2_sorted[0],n=t.int_points1[r.id];for(let s=1;s<t.int_points2_sorted.length;s++){let o=t.int_points2_sorted[s];if(-1==o.id)continue;if(-1==r.id||!i.Utils.EQ(o.arc_length,r.arc_length)){r=o,n=t.int_points1[r.id];continue}let l=t.int_points1[o.id];l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&o.edge_before===r.edge_before&&o.edge_after===r.edge_after&&(l.id=-1,o.id=-1,e=!0)}e&&(t.int_points1=t.int_points1.filter(t=>t.id>=0),t.int_points2=t.int_points2.filter(t=>t.id>=0),t.int_points1.forEach((t,e)=>t.id=e),t.int_points2.forEach((t,e)=>t.id=e),t.int_points1_sorted=[],t.int_points2_sorted=[],c.sortIntersections(t))}static removeNotRelevantNotIntersectedFaces(t,e,n,r,s){let o=[];for(let l of t.faces)if(!r.find(t=>t.face===l)){let t=l.getRelation(e);n===i.BOOLEAN_UNION&&t===i.INSIDE?o.push(l):n===i.BOOLEAN_SUBTRACT&&t===i.INSIDE&&s?o.push(l):n===i.BOOLEAN_INTERSECT&&t===i.OUTSIDE&&o.push(l)}for(let e=0;e<o.length;e++)t.deleteFace(o[e])}static initializeInclusionFlags(t){for(let e of t)e.edge_before.bvStart=void 0,e.edge_before.bvEnd=void 0,e.edge_before.bv=void 0,e.edge_before.overlap=void 0,e.edge_after.bvStart=void 0,e.edge_after.bvEnd=void 0,e.edge_after.bv=void 0,e.edge_after.overlap=void 0;for(let e of t)e.edge_before.bvEnd=i.BOUNDARY,e.edge_after.bvStart=i.BOUNDARY}static calculateInclusionFlags(t,e){for(let n of t)n.edge_before.setInclusion(e),n.edge_after.setInclusion(e)}static setOverlappingFlags(t){let e=void 0,n=void 0,r=void 0,s=t.int_points1.length;for(let o=0;o<s;o++){let l=t.int_points1_sorted[o];l.face!==e&&(n=l,e=l.face),r=o+1===s?n:t.int_points1_sorted[o+1].face!==e?n:t.int_points1_sorted[o+1];let a=l.edge_after,h=r.edge_before;if(a.bv!==i.BOUNDARY||h.bv!==i.BOUNDARY)continue;if(a!==h)continue;let c=t.int_points2[l.id],f=t.int_points2[r.id],u=c.edge_after,p=f.edge_before;u.bv===i.BOUNDARY&&p.bv===i.BOUNDARY&&u===p||(c=t.int_points2[r.id],f=t.int_points2[l.id],u=c.edge_after,p=f.edge_before),u.bv===i.BOUNDARY&&p.bv===i.BOUNDARY&&u===p&&a.setOverlap(u)}}static removeNotRelevantChains(t,e,n,r){if(!n)return;let s,o,l=void 0,a=void 0;for(let h=0;h<n.length;h++){if((s=n[h]).face!==l&&(a=h,l=s.face),l.isEmpty())continue;let f,u=h,p=c.intPointsPullCount(n,h,l);o=n[f=u+p<n.length&&n[u+p].face===s.face?u+p:a];let d=f,g=c.intPointsPullCount(n,d,l),m=s.edge_after,x=o.edge_before;if(m.bv===i.INSIDE&&x.bv===i.INSIDE&&e===i.BOOLEAN_UNION||m.bv===i.OUTSIDE&&x.bv===i.OUTSIDE&&e===i.BOOLEAN_INTERSECT||(m.bv===i.OUTSIDE||x.bv===i.OUTSIDE)&&e===i.BOOLEAN_SUBTRACT&&!r||(m.bv===i.INSIDE||x.bv===i.INSIDE)&&e===i.BOOLEAN_SUBTRACT&&r||m.bv===i.BOUNDARY&&x.bv===i.BOUNDARY&&m.overlap&i.OVERLAP_SAME&&r||m.bv===i.BOUNDARY&&x.bv===i.BOUNDARY&&m.overlap&i.OVERLAP_OPPOSITE){t.removeChain(l,m,x);for(let t=u;t<u+p;t++)s.edge_after=void 0;for(let t=d;t<d+g;t++)o.edge_before=void 0}h+=p-1}}static intPointsPullCount(t,e,n){let i,r,s=1;if(1==t.length)return 1;i=t[e];for(let o=e+1;o<t.length&&i.face==n&&((r=t[o]).pt.equalTo(i.pt)&&r.edge_before===i.edge_before&&r.edge_after===i.edge_after);o++)s++;return s}static copyWrkToRes(t,e,n,r){for(let s of e.faces){for(let e of s)t.edges.add(e);n===i.BOOLEAN_UNION&&r&&void 0===r.find(t=>t.face===s)&&t.addFace(s.first,s.last)}}static swapLinks(t,e,n){if(0!==n.int_points1.length)for(let t=0;t<n.int_points1.length;t++){let e=n.int_points1[t],i=n.int_points2[t];if(void 0!==e.edge_before&&void 0===e.edge_after&&void 0===i.edge_before&&void 0!==i.edge_after&&(e.edge_before.next=i.edge_after,i.edge_after.prev=e.edge_before,e.edge_after=i.edge_after,i.edge_before=e.edge_before),void 0!==i.edge_before&&void 0===i.edge_after&&void 0===e.edge_before&&void 0!==e.edge_after&&(i.edge_before.next=e.edge_after,e.edge_after.prev=i.edge_before,i.edge_after=e.edge_after,e.edge_before=i.edge_before),void 0!==e.edge_before&&void 0===e.edge_after)for(let t of n.int_points1_sorted)t!==e&&void 0===t.edge_before&&void 0!==t.edge_after&&t.pt.equalTo(e.pt)&&(e.edge_before.next=t.edge_after,t.edge_after.prev=e.edge_before,e.edge_after=t.edge_after,t.edge_before=e.edge_before);if(void 0!==i.edge_before&&void 0===i.edge_after)for(let t of n.int_points2_sorted)t!==i&&void 0===t.edge_before&&void 0!==t.edge_after&&t.pt.equalTo(i.pt)&&(i.edge_before.next=t.edge_after,t.edge_after.prev=i.edge_before,i.edge_after=t.edge_after,t.edge_before=i.edge_before)}}static removeOldFaces(t,e){for(let n of e)t.faces.delete(n.face),n.face=void 0,n.edge_before&&(n.edge_before.face=void 0),n.edge_after&&(n.edge_after.face=void 0)}static restoreFaces(t,e,n){for(let i of e){if(void 0===i.edge_before||void 0===i.edge_after)continue;if(i.face)continue;if(i.edge_after.face||i.edge_before.face)continue;let r=i.edge_after,s=i.edge_before,o=t.addFace(r,s);for(let t of e)t.edge_before&&t.edge_after&&t.edge_before.face===o&&t.edge_after.face===o&&(t.face=o);for(let t of n)t.edge_before&&t.edge_after&&t.edge_before.face===o&&t.edge_after.face===o&&(t.face=o)}}}t.exports=c},function(t,e,n){"use strict";let i=n(0);t.exports=function(t){let{Polygon:e,Point:n,Segment:r,Arc:s,Circle:o,Line:l,Ray:a,Vector:h}=t,{vector:c}=t;t.Distance=class e{static point2point(t,e){return t.distanceTo(e)}static point2line(t,e){let n=t.projectionOn(e);return[c(t,n).length,new r(t,n)]}static point2circle(e,n){let[i,s]=e.distanceTo(n.center);if(t.Utils.EQ_0(i))return[n.r,new r(e,n.toArc().start)];{let t=Math.abs(i-n.r),s=c(n.pc,e).normalize().multiply(n.r),o=n.pc.translate(s);return[t,new r(e,o)]}}static point2segment(n,i){if(i.start.equalTo(i.end))return e.point2point(n,i.start);let s,o,l=new t.Vector(i.start,i.end),a=new t.Vector(i.start,n),h=new t.Vector(i.end,n),c=l.dot(a),f=-l.dot(h);if(t.Utils.GE(c,0)&&t.Utils.GE(f,0)){let t=i.tangentInStart();return s=Math.abs(t.cross(a)),o=i.start.translate(t.multiply(t.dot(a))),[s,new r(n,o)]}return c<0?n.distanceTo(i.start):n.distanceTo(i.end)}static point2arc(n,i){let r,s,o=new t.Circle(i.pc,i.r),l=[];return[r,s]=e.point2circle(n,o),s.end.on(i)&&l.push(e.point2circle(n,o)),l.push(e.point2point(n,i.start)),l.push(e.point2point(n,i.end)),e.sort(l),l[0]}static segment2line(t,n){let i=t.intersect(n);return i.length>0?[0,new r(i[0],i[0])]:(dist_and_segment.push(e.point2line(t.start,n)),dist_and_segment.push(e.point2line(t.end,n)),e.sort(dist_and_segment),dist_and_segment[0])}static segment2segment(t,n){let i=r.intersectSegment2Segment(t,n);if(i.length>0)return[0,new r(i[0],i[0])];let s=[];return s.push(e.point2segment(n.start,t)),s.push(e.point2segment(n.end,t)),s.push(e.point2segment(t.start,n)),s.push(e.point2segment(t.end,n)),e.sort(s),s[0]}static segment2circle(n,i){let s=n.intersect(i);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Line(n.ps,n.pe),[l,a]=e.point2line(i.center,o);if(t.Utils.GE(l,i.r)&&a.end.on(n))return e.point2circle(a.end,i);{let[r,s]=e.point2circle(n.start,i),[o,l]=e.point2circle(n.end,i);return t.Utils.LT(r,o)?[r,s]:[o,l]}}static segment2arc(n,i){let s=n.intersect(i);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Line(n.ps,n.pe),l=new t.Circle(i.pc,i.r),[a,h]=e.point2line(l.center,o);if(t.Utils.GE(a,l.r)&&h.end.on(n)){let[t,n]=e.point2circle(h.end,l);if(n.end.on(i))return[t,n]}let c,f,u=[];return u.push(e.point2arc(n.start,i)),u.push(e.point2arc(n.end,i)),[c,f]=e.point2segment(i.start,n),u.push([c,f.reverse()]),[c,f]=e.point2segment(i.end,n),u.push([c,f.reverse()]),e.sort(u),u[0]}static circle2circle(t,n){let i=t.intersect(n);if(i.length>0)return[0,new r(i[0],i[0])];if(t.center.equalTo(n.center)){let i=t.toArc(),r=n.toArc();return e.point2point(i.start,r.start)}{let i=new l(t.center,n.center),r=i.intersect(t),s=i.intersect(n),o=[];return o.push(e.point2point(r[0],s[0])),o.push(e.point2point(r[0],s[1])),o.push(e.point2point(r[1],s[0])),o.push(e.point2point(r[1],s[1])),e.sort(o),o[0]}}static circle2line(t,n){let i=t.intersect(n);if(i.length>0)return[0,new r(i[0],i[0])];let[s,o]=e.point2line(t.center,n),[l,a]=e.point2circle(o.end,t);return[l,a=a.reverse()]}static arc2line(n,i){let s=i.intersect(n);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Circle(n.center,n.r),[l,a]=e.point2line(o.center,i);if(!t.Utils.GE(l,o.r)){let t=[];return t.push(e.point2line(n.start,i)),t.push(e.point2line(n.end,i)),e.sort(t),t[0]}{let[t,i]=e.point2circle(a.end,o);if(i.end.on(n))return[t,i]}}static arc2circle(n,i){let s=n.intersect(i);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Circle(n.center,n.r),[l,a]=e.circle2circle(o,i);if(a.start.on(n))return[l,a];{let t=[];return t.push(e.point2circle(n.start,i)),t.push(e.point2circle(n.end,i)),e.sort(t),t[0]}}static arc2arc(n,i){let s=n.intersect(i);if(s.length>0)return[0,new r(s[0],s[0])];let o=new t.Circle(n.center,n.r),l=new t.Circle(i.center,i.r),[a,h]=e.circle2circle(o,l);if(h.start.on(n)&&h.end.on(i))return[a,h];{let t,r,s=[];return[t,r]=e.point2arc(n.start,i),r.end.on(i)&&s.push([t,r]),[t,r]=e.point2arc(n.end,i),r.end.on(i)&&s.push([t,r]),[t,r]=e.point2arc(i.start,n),r.end.on(n)&&s.push([t,r.reverse()]),[t,r]=e.point2arc(i.end,n),r.end.on(n)&&s.push([t,r.reverse()]),[t,r]=e.point2point(n.start,i.start),s.push([t,r]),[t,r]=e.point2point(n.start,i.end),s.push([t,r]),[t,r]=e.point2point(n.end,i.start),s.push([t,r]),[t,r]=e.point2point(n.end,i.end),s.push([t,r]),e.sort(s),s[0]}}static point2polygon(n,i){let s=[Number.POSITIVE_INFINITY,new r];for(let o of i.edges){let[i,l]=o.shape instanceof r?e.point2segment(n,o.shape):e.point2arc(n,o.shape);t.Utils.LT(i,s[0])&&(s=[i,l])}return s}static shape2polygon(e,n){let i=[Number.POSITIVE_INFINITY,new r];for(let r of n.edges){let[n,s]=e.distanceTo(r.shape);t.Utils.LT(n,i[0])&&(i=[n,s])}return i}static polygon2polygon(e,n){let i=[Number.POSITIVE_INFINITY,new t.Segment];for(let r of e.edges)for(let e of n.edges){let[n,s]=r.shape.distanceTo(e.shape);t.Utils.LT(n,i[0])&&(i=[n,s])}return i}static box2box_minmax(t,e){let n=Math.max(Math.max(t.xmin-e.xmax,0),Math.max(e.xmin-t.xmax,0)),i=Math.max(Math.max(t.ymin-e.ymax,0),Math.max(e.ymin-t.ymax,0)),r=n*n+i*i,s=t.merge(e),o=s.xmax-s.xmin,l=s.ymax-s.ymin;return[r,o*o+l*l]}static minmax_tree_process_level(n,i,r,s){let o,l;for(let a of i)[o,l]=e.box2box_minmax(n.box,a.item.key),a.item.value instanceof t.Edge?s.insert([o,l],a.item.value.shape):s.insert([o,l],a.item.value),t.Utils.LT(l,r)&&(r=l);if(0===i.length)return r;let a=i.map(t=>t.left.isNil()?void 0:t.left).filter(t=>void 0!==t),h=i.map(t=>t.right.isNil()?void 0:t.right).filter(t=>void 0!==t),c=[...a,...h].filter(i=>{let[s,o]=e.box2box_minmax(n.box,i.max);return t.Utils.LE(s,r)});return r=e.minmax_tree_process_level(n,c,r,s)}static minmax_tree(t,n,r){let s=new i,o=[n.index.root],l=r<Number.POSITIVE_INFINITY?r*r:Number.POSITIVE_INFINITY;return l=e.minmax_tree_process_level(t,o,l,s),s}static minmax_tree_calc_distance(n,i,r){let s,o;if(null!=i&&!i.isNil()){if([s,o]=e.minmax_tree_calc_distance(n,i.left,r),o)return[s,o];if(t.Utils.LT(s[0],Math.sqrt(i.item.key.low)))return[s,!0];let[l,a]=e.distance(n,i.item.value);return t.Utils.LT(l,s[0])&&(s=[l,a]),[s,o]=e.minmax_tree_calc_distance(n,i.right,s),[s,o]}return[r,!1]}static shape2planarSet(n,i,r=Number.POSITIVE_INFINITY){let s=[r,new t.Segment],o=!1;if(i instanceof t.PlanarSet){let t=e.minmax_tree(n,i,r);[s,o]=e.minmax_tree_calc_distance(n,t.root,s)}return s}static sort(e){e.sort((e,n)=>t.Utils.LT(e[0],n[0])?-1:t.Utils.GT(e[0],n[0])?1:0)}static distance(t,e){return t.distanceTo(e)}}}},function(t,e,n){"use strict";t.exports=function(t){let{Edge:e,Face:n,PlanarSet:i,Box:r}=t,{ray_shoot:s}=t;t.Polygon=class e{constructor(){this.faces=new i,this.edges=new i}get box(){return[...this.faces].reduce((t,e)=>t.merge(e.box),new r)}get vertices(){return[...this.edges].map(t=>t.start)}addFace(...t){let e=new n(this,...t);return this.faces.add(e),e}deleteFace(t){for(let e of t){this.edges.delete(e)}return this.faces.delete(t)}removeChain(t,e,n){if(n.next!==e){for(let i=e;i!==n.next;i=i.next)if(t.remove(this.edges,i),t.isEmpty()){this.deleteFace(t);break}}else this.deleteFace(t)}addVertex(e,n){let i=n.shape.split(e);if(i.length<2)return;let r=new t.Edge(i[0]),s=n.prev;return n.face.insert(this.edges,r,s),this.edges.delete(n),n.shape=i[1],this.edges.add(n),r}reverse(){for(let t of this.faces)t.reverse();return this}clone(){let t=new e;for(let e of this.faces){let n=[];for(let t of e)n.push(t.shape.clone());t.addFace(n)}return t}area(){let t=[...this.faces].reduce((t,e)=>t+e.signedArea(),0);return Math.abs(t)}contains(e){let n=s(this,e);return n==t.INSIDE||n==t.BOUNDARY}distanceTo(e){let{Distance:n}=t;if(e instanceof t.Point){let[t,i]=n.point2polygon(e,this);return[t,i=i.reverse()]}if(e instanceof t.Circle||e instanceof t.Line||e instanceof t.Segment||e instanceof t.Arc){let[t,i]=n.shape2polygon(e,this);return[t,i=i.reverse()]}if(e instanceof t.Polygon){let i,r,s=[Number.POSITIVE_INFINITY,new t.Segment];for(let o of this.edges){let l=s[0];[i,r]=n.shape2planarSet(o.shape,e.edges,l),t.Utils.LT(i,l)&&(s=[i,r])}return s}}isValid(){let t=!0;for(let e of this.faces)if(!e.isSimple(this.edges)){t=!1;break}return t}translate(t){let n=new e;for(let e of this.faces){let i=[];for(let n of e)i.push(n.shape.translate(t));n.addFace(i)}return n}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillRule:r,fillOpacity:s,id:o,className:l}=t,a=o&&o.length>0?`id="${o}"`:"",h=l&&l.length>0?`class="${l}"`:"",c=`\n<path stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"lightcyan"}" fill-rule="${r||"evenodd"}" fill-opacity="${s||1}" ${a} ${h} d="`;for(let t of this.faces)c+=t.svg();return c+='" >\n</path>'}toJSON(){return[...this.faces].map(t=>t.toJSON())}}}},function(t,e,n){"use strict";t.exports=function(t){let{Polygon:e,Point:n,Segment:i,Arc:r,Line:s,Ray:o}=t;t.ray_shoot=function(e,n){let r=void 0;if(e.box.notIntersect(n.box))return t.OUTSIDE;let l=new o(n),a=new s(l.pt,l.norm),h=e.edges.search(l.box);if(0==h.length)return t.OUTSIDE;let c=[];for(let e of h)for(let i of l.intersect(e.shape)){if(i.equalTo(n))return t.BOUNDARY;c.push({pt:i,edge:e})}c.sort((e,n)=>t.Utils.LT(e.pt.x,n.pt.x)?-1:t.Utils.GT(e.pt.x,n.pt.x)?1:0);let f=0;for(let e=0;e<c.length;e++){let n=c[e];if(n.pt.equalTo(n.edge.shape.start)){if(e>0&&n.pt.equalTo(c[e-1].pt)&&n.edge.prev===c[e-1].edge)continue;let t=n.edge.prev.shape.tangentInEnd(),i=n.pt.translate(t),r=n.edge.shape.tangentInStart(),s=n.pt.translate(r),o=i.leftTo(a),l=s.leftTo(a);(o&&!l||!o&&l)&&f++}else if(n.pt.equalTo(n.edge.shape.end)){if(e>0&&n.pt.equalTo(c[e-1].pt)&&n.edge.next===c[e-1].edge)continue;let t=n.edge.next.shape.tangentInStart(),i=n.pt.translate(t),r=n.edge.shape.tangentInEnd(),s=n.pt.translate(r),o=i.leftTo(a),l=s.leftTo(a);(o&&!l||!o&&l)&&f++}else if(n.edge.shape instanceof i)f++;else{let e=n.edge.shape.box;t.Utils.EQ(n.pt.y,e.ymin)||t.Utils.EQ(n.pt.y,e.ymax)||f++}}return r=f%2==1?t.INSIDE:t.OUTSIDE}}},function(t,e,n){"use strict";t.exports=function(t){let{Point:e,Segment:n,Line:i,Circle:r,Arc:s,Box:o,Vector:l}=t;t.Ray=class r{constructor(...n){if(this.pt=new e,0!=n.length)if(1==n.length&&n[0]instanceof e)this.pt=n[0].clone();else{if(2!=n.length||"number"!=typeof n[0]||"number"!=typeof n[1])throw t.Errors.ILLEGAL_PARAMETERS;this.pt=new e(n[0],n[1])}}clone(){return new r(this.pt)}get box(){return new o(this.pt.x,this.pt.y,Number.POSITIVE_INFINITY,this.pt.y)}get start(){return this.pt}get norm(){return new l(0,1)}intersect(t){return t instanceof n?this.intersectRay2Segment(this,t):t instanceof s?this.intersectRay2Arc(this,t):void 0}intersectRay2Segment(e,n){let r=[];if(e.box.notIntersect(n.box))return r;let s=new i(e.start,e.norm),o=s.intersect(n);for(let n of o)t.Utils.GE(n.x,e.start.x)&&r.push(n);return 2==o.length&&1==r.length&&e.start.on(s)&&r.push(e.start),r}intersectRay2Arc(e,n){let r=[];if(e.box.notIntersect(n.box))return r;let s=new i(e.start,e.norm).intersect(n);for(let n of s)t.Utils.GE(n.x,e.start.x)&&r.push(n);return r}},t.ray=((...e)=>new t.Ray(...e))}},function(t,e,n){"use strict";t.exports=function(t){let{Point:e,Segment:n,Arc:i,Box:r,Edge:s}=t;t.Face=class r{constructor(t,...o){if(this.first,this.last,this._box=void 0,this._orientation=void 0,0!=o.length){if(1==o.length)if(o[0]instanceof Array){let s=o[0];if(0==s.length)return;if(s.every(t=>t instanceof e)){let e=r.points2segments(s);this.shapes2face(t.edges,e)}else if(s.every(t=>t instanceof n||t instanceof i))this.shapes2face(t.edges,s);else if(s.every(t=>"segment"===t.name||"arc"===t.name)){let r=[];for(let t of s){let s;s="segment"===t.name?new n(t.ps.x,t.ps.y,t.pe.x,t.pe.y):new i(new e(t.pc.x,t.pc.y),t.r,t.startAngle,t.endAngle,t.counterClockwise),r.push(s)}this.shapes2face(t.edges,r)}}else if(o[0]instanceof r){let e=o[0];this.first=e.first,this.last=e.last;for(let n of e)t.edges.add(n)}2==o.length&&o[0]instanceof s&&o[1]instanceof s&&(this.first=o[0],this.last=o[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}[Symbol.iterator](){let t=void 0;return{next:()=>{let e=t||this.first,n=!this.first||!!t&&t===this.first;return t=e?e.next:void 0,{value:e,done:n}}}}get edges(){let t=[];for(let e of this)t.push(e);return t}get size(){let t=0;for(let e of this)t++;return t}static points2segments(t){let e=[];for(let i=0;i<t.length;i++)e.push(new n(t[i],t[(i+1)%t.length]));return e}shapes2face(t,e){for(let n of e){let e=new s(n);this.append(t,e)}}isEmpty(){return void 0===this.first&&void 0===this.last}append(t,e){void 0===this.first?(e.prev=e,e.next=e,this.first=e,this.last=e,e.arc_length=0):(e.prev=this.last,this.last.next=e,this.last=e,this.last.next=this.first,this.first.prev=this.last,e.arc_length=e.prev.arc_length+e.prev.length),e.face=this,t.add(e)}insert(t,e,n){if(void 0===this.first)e.prev=e,e.next=e,this.first=e,this.last=e;else{let t=n.next;n.next=e,t.prev=e,e.prev=n,e.next=t,this.last===n&&(this.first=e)}e.face=this,e.prev===this.last?e.arc_length=0:e.arc_length=e.prev.arc_length+e.prev.length,t.add(e)}remove(t,e){e===this.first&&e===this.last?(this.first=void 0,this.last=void 0):(e.prev.next=e.next,e.next.prev=e.prev,e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)),t.delete(e)}reverse(){let t=[],e=this.last;do{e.shape=e.shape.reverse(),t.push(e),e=e.prev}while(e!==this.last);this.first=void 0,this.last=void 0;for(let e of t)void 0===this.first?(e.prev=e,e.next=e,this.first=e,this.last=e,e.arc_length=0):(e.prev=this.last,this.last.next=e,this.last=e,this.last.next=this.first,this.first.prev=this.last,e.arc_length=e.prev.arc_length+e.prev.length);void 0!==this._orientation&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let t of this)t===this.first?t.arc_length=0:t.arc_length=t.prev.arc_length+t.prev.length,t.face=this}area(){return Math.abs(this.signedArea())}signedArea(){let t=0;for(let e of this)t+=e.shape.definiteIntegral(this.box.ymin);return t}orientation(){if(void 0===this._orientation){let e=this.signedArea();t.Utils.EQ_0(e)?this._orientation=t.ORIENTATION.NOT_ORIENTABLE:t.Utils.LT(e,0)?this._orientation=t.ORIENTATION.CCW:this._orientation=t.ORIENTATION.CW}return this._orientation}get box(){if(void 0===this._box){let e=new t.Box;for(let t of this)e=e.merge(t.box);this._box=e}return this._box}getRelation(e){this.first.bv=this.first.bvStart=this.first.bvEnd=void 0;let n=this.first.setInclusion(e),i=e.faces.search(this.box);if(0===i.length)return n;{let r=new t.Polygon;r.addFace(this);let s=0;for(let e of i){e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(r)===t.INSIDE&&s++}if(n===t.OUTSIDE)return 0===s?t.OUTSIDE:s===i.length&&i.length===e.faces.size?t.CONTAINS:t.INTERLACE;if(n===t.INSIDE)return 0===s?t.INSIDE:t.INTERLACE}}isSimple(t){return 0==r.getSelfIntersections(this,t,!0).length}static getSelfIntersections(e,n,i=!1){let r=[];for(let s of e){let e=n.search(s.box);for(let n of e){if(s===n)continue;if(s.shape instanceof t.Segment&&n.shape instanceof t.Segment&&(s.next===n||s.prev===n))continue;let e=s.shape.intersect(n.shape);for(let t of e)if((!t.equalTo(s.start)||!t.equalTo(n.end)||n!==s.prev)&&(!t.equalTo(s.end)||!t.equalTo(n.start)||n!==s.next)&&(r.push(t),i))break;if(r.length>0&&i)break}if(r.length>0&&i)break}return r}toJSON(){return this.edges.map(t=>t.toJSON())}svg(){let t=`\nM${this.first.start.x},${this.first.start.y}`;for(let e of this)t+=e.svg();return t+=" z"}}}},function(t,e){t.exports=function(t){t.Edge=class{constructor(t){this.shape=t,this.next,this.prev,this.face,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof t.Segment}isArc(){return this.shape instanceof t.Arc}middle(){return this.shape.middle()}contains(t){return this.shape.contains(t)}setInclusion(e){if(void 0!==this.bv)return this.bv;if(void 0===this.bvStart&&(this.bvStart=t.ray_shoot(e,this.start)),void 0===this.bvEnd&&(this.bvEnd=t.ray_shoot(e,this.end)),this.bvStart===t.OUTSIDE||this.bvEnd==t.OUTSIDE)this.bv=t.OUTSIDE;else if(this.bvStart===t.INSIDE||this.bvEnd==t.INSIDE)this.bv=t.INSIDE;else{let n=t.ray_shoot(e,this.middle());this.bv=n}return this.bv}setOverlap(e){let n=void 0,i=this.shape,r=e.shape;i instanceof t.Segment&&r instanceof t.Segment?i.start.equalTo(r.start)&&i.end.equalTo(r.end)?n=t.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&(n=t.OVERLAP_OPPOSITE):i instanceof t.Arc&&r instanceof t.Arc?i.start.equalTo(r.start)&&i.end.equalTo(r.end)&&i.counterClockwise===r.counterClockwise&&i.middle().equalTo(r.middle())?n=t.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&i.counterClockwise!==r.counterClockwise&&i.middle().equalTo(r.middle())&&(n=t.OVERLAP_OPPOSITE):(i instanceof t.Segment&&r instanceof t.Arc||i instanceof t.Arc&&r instanceof t.Segment)&&(i.start.equalTo(r.start)&&i.end.equalTo(r.end)&&i.middle().equalTo(r.middle())?n=t.OVERLAP_SAME:i.start.equalTo(r.end)&&i.end.equalTo(r.start)&&i.middle().equalTo(r.middle())&&(n=t.OVERLAP_OPPOSITE)),void 0===this.overlap&&(this.overlap=n),void 0===e.overlap&&(e.overlap=n)}svg(){if(this.shape instanceof t.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof t.Arc){let e,n=this.shape,i=n.counterClockwise?"1":"0";if(t.Utils.EQ(n.sweep,2*Math.PI)){let r=n.counterClockwise?1:-1,s=new t.Arc(n.pc,n.r,n.startAngle,n.startAngle+r*Math.PI,n.counterClockwise),o=new t.Arc(n.pc,n.r,n.startAngle+r*Math.PI,n.endAngle,n.counterClockwise);return e="0",` A${s.r},${s.r} 0 ${e},${i} ${s.end.x},${s.end.y}\n                    A${o.r},${o.r} 0 ${e},${i} ${o.end.x},${o.end.y}`}return e=n.sweep<=Math.PI?"0":"1",` A${n.r},${n.r} 0 ${e},${i} ${n.end.x},${n.end.y}`}}toJSON(){let e=this.shape.clone();return e.name=this.shape instanceof t.Segment?"segment":"arc",e}}}},function(t,e,n){"use strict";t.exports=function(t){t.Box=class e{constructor(t,e,n,i){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i}clone(){return new e(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new t.Point(this.xmin,this.ymin)}get high(){return new t.Point(this.xmax,this.ymax)}get max(){return this.clone()}notIntersect(t){return this.xmax<t.xmin||this.xmin>t.xmax||this.ymax<t.ymin||this.ymin>t.ymax}intersect(t){return!this.notIntersect(t)}merge(t){return new e(void 0===this.xmin?t.xmin:Math.min(this.xmin,t.xmin),void 0===this.ymin?t.ymin:Math.min(this.ymin,t.ymin),void 0===this.xmax?t.xmax:Math.max(this.xmax,t.xmax),void 0===this.ymax?t.ymax:Math.max(this.ymax,t.ymax))}less_than(t){return!!this.low.lessThan(t.low)||!(!this.low.equalTo(t.low)||!this.high.lessThan(t.high))}equal_to(t){return this.low.equalTo(t.low)&&this.high.equalTo(t.high)}output(){return this.clone()}maximal_val(t,e){return t.merge(e)}val_less_than(t,e){return t.lessThan(e)}set(t,e,n,i){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,id:r,className:s}=t,o=r&&r.length>0?`id="${r}"`:"",l=s&&s.length>0?`class="${s}"`:"",a=this.xmax-this.xmin,h=this.ymax-this.ymin;return`\n<rect x="${this.xmin}" y="${this.ymin}" width=${a} height=${h} stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" ${o} ${l} />`}}}},function(t,e,n){"use strict";t.exports=function(t){t.Arc=class e{constructor(e=new t.Point,n=1,i=0,r=2*Math.PI,s=!0){this.pc=e.clone(),this.r=n,this.startAngle=i,this.endAngle=r,this.counterClockwise=s}clone(){return new t.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){if(t.Utils.EQ(this.startAngle,this.endAngle))return 0;if(t.Utils.EQ(Math.abs(this.startAngle-this.endAngle),t.PIx2))return t.PIx2;let e;return e=this.counterClockwise?t.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+t.PIx2:t.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+t.PIx2,t.Utils.GT(e,t.PIx2)&&(e-=t.PIx2),t.Utils.LT(e,0)&&(e+=t.PIx2),e}get start(){return new t.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new t.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){let e=this.breakToFunctional().reduce((t,e)=>t.merge(e.start.box),new t.Box);return e=e.merge(this.end.box)}contains(e){if(!t.Utils.EQ(this.pc.distanceTo(e)[0],this.r))return!1;if(e.equalTo(this.start))return!0;let n=new t.Vector(this.pc,e).slope,i=new t.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise);return t.Utils.LE(i.length,this.length)}split(e){if(!this.contains(e))return[];if(t.Utils.EQ_0(this.sweep))return[this.clone()];if(this.start.equalTo(e)||this.end.equalTo(e))return[this.clone()];let n=new t.Vector(this.pc,e).slope;return[new t.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise),new t.Arc(this.pc,this.r,n,this.endAngle,this.counterClockwise)]}middle(){let e=this.counterClockwise===t.CCW?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new t.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(n){return n instanceof t.Line?n.intersect(this):n instanceof t.Circle?e.intersectArc2Circle(this,n):n instanceof t.Segment?n.intersect(this):n instanceof t.Arc?e.intersectArc2Arc(this,n):void 0}distanceTo(e){let{Distance:n}=t;if(e instanceof t.Point){let[t,i]=n.point2arc(e,this);return[t,i=i.reverse()]}if(e instanceof t.Circle){let[t,i]=n.arc2circle(this,e);return[t,i]}if(e instanceof t.Line){let[t,i]=n.arc2line(this,e);return[t,i]}if(e instanceof t.Segment){let[t,i]=n.segment2arc(e,this);return[t,i=i.reverse()]}if(e instanceof t.Arc){let[t,i]=n.arc2arc(this,e);return[t,i]}if(e instanceof t.Polygon){let[t,i]=n.shape2polygon(this,e);return[t,i]}if(e instanceof t.PlanarSet){let[t,i]=n.shape2planarSet(this,e);return[t,i]}}breakToFunctional(){let e=[],n=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],i=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],r=[];for(let e=0;e<4;e++)i[e].on(this)&&r.push(new t.Arc(this.pc,this.r,this.startAngle,n[e],this.counterClockwise));if(0==r.length)e.push(this.clone());else{r.sort((t,e)=>t.length-e.length);for(let n=0;n<r.length;n++){let i,s=e.length>0?e[e.length-1]:void 0;i=s?new t.Arc(this.pc,this.r,s.endAngle,r[n].endAngle,this.counterClockwise):new t.Arc(this.pc,this.r,this.startAngle,r[n].endAngle,this.counterClockwise),t.Utils.EQ_0(i.length)||e.push(i.clone())}let n,i=e.length>0?e[e.length-1]:void 0;n=i?new t.Arc(this.pc,this.r,i.endAngle,this.endAngle,this.counterClockwise):new t.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),t.Utils.EQ_0(n.length)||e.push(n.clone())}return e}tangentInStart(){let e=new t.Vector(this.pc,this.start),n=this.counterClockwise?Math.PI/2:-Math.PI/2;return e.rotate(n).normalize()}tangentInEnd(){let e=new t.Vector(this.pc,this.end),n=this.counterClockwise?-Math.PI/2:Math.PI/2;return e.rotate(n).normalize()}reverse(){return new e(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(t){let e=this.clone();return e.pc=this.pc.translate(t),e}static intersectArc2Arc(e,n){var i=[];if(e.box.notIntersect(n.box))return i;if(e.pc.equalTo(n.pc)&&t.Utils.EQ(e.r,n.r)){let t;return(t=e.start).on(n)&&i.push(t),(t=e.end).on(n)&&i.push(t),(t=n.start).on(e)&&i.push(t),(t=n.end).on(e)&&i.push(t),i}let r=new t.Circle(e.pc,e.r),s=new t.Circle(n.pc,n.r),o=r.intersect(s);for(let t of o)t.on(e)&&t.on(n)&&i.push(t);return i}static intersectArc2Circle(e,n){let i=[];if(e.box.notIntersect(n.box))return i;if(n.pc.equalTo(e.pc)&&t.Utils.EQ(n.r,e.r))return i.push(e.start),i.push(e.end),i;let r=n,s=new t.Circle(e.pc,e.r),o=r.intersect(s);for(let t of o)t.on(e)&&i.push(t);return i}definiteIntegral(t=0){return this.breakToFunctional().reduce((e,n)=>e+n.circularSegmentDefiniteIntegral(t),0)}circularSegmentDefiniteIntegral(e){let n=new t.Line(this.start,this.end),i=this.pc.leftTo(n),r=new t.Segment(this.start,this.end).definiteIntegral(e),s=this.circularSegmentArea();return i?r-s:r+s}circularSegmentArea(){return.5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}svg(e={}){let n=this.sweep<=Math.PI?"0":"1",i=this.counterClockwise?"1":"0",{stroke:r,strokeWidth:s,fill:o,id:l,className:a}=e,h=l&&l.length>0?`id="${l}"`:"",c=a&&a.length>0?`class="${a}"`:"";if(t.Utils.EQ(this.sweep,2*Math.PI)){return new t.Circle(this.pc,this.r).svg(e)}return`\n<path d="M${this.start.x},${this.start.y}\n                             A${this.r},${this.r} 0 ${n},${i} ${this.end.x},${this.end.y}"\n                    stroke="${r||"black"}" stroke-width="${s||1}" fill="${o||"none"}" ${h} ${c} />`}},t.arc=((...e)=>new t.Arc(...e))}},function(t,e,n){"use strict";t.exports=function(t){t.Segment=class e{constructor(...e){if(this.ps=new t.Point,this.pe=new t.Point,0!=e.length){if(1==e.length&&e[0]instanceof Array&&4==e[0].length){let n=e[0];return this.ps=new t.Point(n[0],n[1]),void(this.pe=new t.Point(n[2],n[3]))}if(2==e.length&&e[0]instanceof t.Point&&e[1]instanceof t.Point)return this.ps=e[0].clone(),void(this.pe=e[1].clone());if(4==e.length)return this.ps=new t.Point(e[0],e[1]),void(this.pe=new t.Point(e[2],e[3]));throw t.Errors.ILLEGAL_PARAMETERS}}clone(){return new t.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new t.Vector(this.start,this.end).slope}get box(){return new t.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}contains(e){return t.Utils.EQ_0(this.distanceToPoint(e))}intersect(n){return n instanceof t.Line?e.intersectSegment2Line(this,n):n instanceof t.Segment?e.intersectSegment2Segment(this,n):n instanceof t.Circle?e.intersectSegment2Circle(this,n):n instanceof t.Arc?e.intersectSegment2Arc(this,n):void 0}distanceTo(e){let{Distance:n}=t;if(e instanceof t.Point){let[t,i]=n.point2segment(e,this);return[t,i=i.reverse()]}if(e instanceof t.Circle){let[t,i]=n.segment2circle(this,e);return[t,i]}if(e instanceof t.Line){let[t,i]=n.segment2line(this,e);return[t,i]}if(e instanceof t.Segment){let[t,i]=n.segment2segment(this,e);return[t,i]}if(e instanceof t.Arc){let[t,i]=n.segment2arc(this,e);return[t,i]}if(e instanceof t.Polygon){let[t,i]=n.shape2polygon(this,e);return[t,i]}if(e instanceof t.PlanarSet){let[t,i]=n.shape2planarSet(this,e);return[t,i]}}tangentInStart(){return new t.Vector(this.start,this.end).normalize()}tangentInEnd(){return new t.Vector(this.end,this.start).normalize()}reverse(){return new e(this.end,this.start)}split(e){return this.contains(e)?this.start.equalTo(this.end)?[this.clone()]:this.start.equalTo(e)||this.end.equalTo(e)?[this]:[new t.Segment(this.start,e),new t.Segment(e,this.end)]:[]}middle(){return new t.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}distanceToPoint(e){let[n,...i]=t.Distance.point2segment(e,this);return n}definiteIntegral(t=0){return(this.end.x-this.start.x)*(this.start.y-t+(this.end.y-t))/2}translate(t){return new e(this.ps.translate(t),this.pe.translate(t))}isZeroLength(){return this.ps.equalTo(this.pe)}static intersectSegment2Line(e,n){let i=[];return e.ps.on(n)&&i.push(e.ps),e.pe.on(n)&&!e.isZeroLength()&&i.push(e.pe),i.length>0?i:e.isZeroLength()?i:e.ps.leftTo(n)&&e.pe.leftTo(n)||!e.ps.leftTo(n)&&!e.pe.leftTo(n)?i:new t.Line(e.ps,e.pe).intersect(n)}static intersectSegment2Segment(e,n){let i=[];if(e.box.notIntersect(n.box))return i;if(e.isZeroLength())return e.ps.on(n)&&i.push(e.ps),i;if(n.isZeroLength())return n.ps.on(e)&&i.push(n.ps),i;let r=new t.Line(e.ps,e.pe),s=new t.Line(n.ps,n.pe);if(r.incidentTo(s))e.ps.on(n)&&i.push(e.ps),e.pe.on(n)&&i.push(e.pe),!n.ps.on(e)||n.ps.equalTo(e.ps)||n.ps.equalTo(e.pe)||i.push(n.ps),!n.pe.on(e)||n.pe.equalTo(e.ps)||n.pe.equalTo(e.pe)||i.push(n.pe);else{let t=r.intersect(s);t.length>0&&t[0].on(e)&&t[0].on(n)&&i.push(t[0])}return i}static intersectSegment2Circle(e,n){let i=[];if(e.box.notIntersect(n.box))return i;if(e.isZeroLength()){let[r,s]=e.ps.distanceTo(n.pc);return t.Utils.EQ(r,n.r)&&i.push(e.ps),i}let r=new t.Line(e.ps,e.pe).intersect(n);for(let t of r)t.on(e)&&i.push(t);return i}static intersectSegment2Arc(e,n){let i=[];if(e.box.notIntersect(n.box))return i;if(e.isZeroLength())return e.ps.on(n)&&i.push(e.ps),i;let r=new t.Line(e.ps,e.pe),s=new t.Circle(n.pc,n.r),o=r.intersect(s);for(let t of o)t.on(e)&&t.on(n)&&i.push(t);return i}svg(t={}){let{stroke:e,strokeWidth:n,id:i,className:r}=t,s=i&&i.length>0?`id="${i}"`:"",o=r&&r.length>0?`class="${r}"`:"";return`\n<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" stroke="${e||"black"}" stroke-width="${n||1}" ${s} ${o} />`}},t.segment=((...e)=>new t.Segment(...e))}},function(t,e,n){"use strict";t.exports=function(t){let{Arc:e,vector:n}=t;t.Circle=class e{constructor(t,e){this.pc=t,this.r=e}clone(){return new t.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new t.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(e){return t.Utils.LE(e.distanceTo(this.center)[0],this.r)}toArc(e=!0){return new t.Arc(this.center,this.r,Math.PI,-Math.PI,e)}intersect(n){return n instanceof t.Line?n.intersect(this):n instanceof t.Segment?n.intersect(this):n instanceof t.Circle?e.intersectCirle2Circle(this,n):n instanceof t.Arc?n.intersect(this):void 0}distanceTo(e){let{Distance:n}=t,{point2circle:i,circle2circle:r,circle2line:s,segment2circle:o,arc2circle:l}=n;if(e instanceof t.Point){let[t,n]=i(e,this);return[t,n=n.reverse()]}if(e instanceof t.Circle){let[t,n]=r(this,e);return[t,n]}if(e instanceof t.Line){let[t,n]=s(this,e);return[t,n]}if(e instanceof t.Segment){let[t,n]=o(e,this);return[t,n=n.reverse()]}if(e instanceof t.Arc){let[t,n]=l(e,this);return[t,n=n.reverse()]}if(e instanceof t.Polygon){let[t,i]=n.shape2polygon(this,e);return[t,i]}if(e instanceof t.PlanarSet){let[t,i]=n.shape2planarSet(this,e);return[t,i]}}static intersectCirle2Circle(e,n){let i=[];if(e.box.notIntersect(n.box))return i;let r=new t.Vector(e.pc,n.pc),s=e.r,o=n.r;if(t.Utils.EQ_0(s)||t.Utils.EQ_0(o))return i;if(t.Utils.EQ_0(r.x)&&t.Utils.EQ_0(r.y)&&t.Utils.EQ(s,o))return i.push(e.pc.translate(-s,0)),i;let l,a=e.pc.distanceTo(n.pc)[0];if(t.Utils.GT(a,s+o))return i;if(t.Utils.LT(a,Math.abs(s-o)))return i;if(r.x/=a,r.y/=a,t.Utils.EQ(a,s+o)||t.Utils.EQ(a,Math.abs(s-o)))return l=e.pc.translate(s*r.x,s*r.y),i.push(l),i;let h=s*s/(2*a)-o*o/(2*a)+a/2,c=e.pc.translate(h*r.x,h*r.y),f=Math.sqrt(s*s-h*h);return l=c.translate(r.rotate90CCW().multiply(f)),i.push(l),l=c.translate(r.rotate90CW().multiply(f)),i.push(l),i}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillOpacity:r,id:s,className:o}=t,l=s&&s.length>0?`id="${s}"`:"",a=o&&o.length>0?`class="${o}"`:"";return`\n<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}" stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${r||1}" ${l} ${a} />`}},t.circle=((...e)=>new t.Circle(...e))}},function(t,e,n){"use strict";t.exports=function(t){t.Line=class e{constructor(...n){if(this.pt=new t.Point,this.norm=new t.Vector(0,1),0!=n.length){if(2==n.length){let i=n[0],r=n[1];if(i instanceof t.Point&&r instanceof t.Point)return this.pt=i,void(this.norm=e.points2norm(i,r));if(i instanceof t.Point&&r instanceof t.Vector){if(t.Utils.EQ_0(r.x)&&t.Utils.EQ_0(r.y))throw t.Errors.ILLEGAL_PARAMETERS;return this.pt=i.clone(),void(this.norm=r.clone())}if(i instanceof t.Vector&&r instanceof t.Point){if(t.Utils.EQ_0(i.x)&&t.Utils.EQ_0(i.y))throw t.Errors.ILLEGAL_PARAMETERS;return this.pt=r.clone(),void(this.norm=i.clone())}}throw t.Errors.ILLEGAL_PARAMETERS}}clone(){return new t.Line(this.pt,this.norm)}get slope(){return new t.Vector(this.norm.y,-this.norm.x).slope}get standard(){return[this.norm.x,this.norm.y,this.norm.dot(this.pt)]}parallelTo(e){return t.Utils.EQ_0(this.norm.cross(e.norm))}incidentTo(t){return(this.norm.equalTo(t.norm)||this.norm.equalTo(t.norm.invert()))&&this.pt.on(t)}contains(e){if(this.pt.equalTo(e))return!0;let n=new t.Vector(this.pt,e);return t.Utils.EQ_0(this.norm.dot(n))}intersect(n){return n instanceof t.Line?e.intersectLine2Line(this,n):n instanceof t.Circle?e.intersectLine2Circle(this,n):n instanceof t.Segment?n.intersect(this):n instanceof t.Arc?e.intersectLine2Arc(this,n):void 0}distanceTo(e){let{Distance:n}=t;if(e instanceof t.Point){let[t,i]=n.point2line(e,this);return[t,i=i.reverse()]}if(e instanceof t.Circle){let[t,i]=n.circle2line(e,this);return[t,i=i.reverse()]}if(e instanceof t.Segment){let[t,i]=n.segment2line(e,this);return[t,i.reverse()]}if(e instanceof t.Arc){let[t,i]=n.arc2line(e,this);return[t,i.reverse()]}if(e instanceof t.Polygon){let[t,i]=n.shape2polygon(this,e);return[t,i]}}svg(n,i={}){let r=e.intersectLine2Box(this,n);if(0===r.length)return"";let s=r[0],o=2==r.length?r[1]:r.find(t=>!t.equalTo(s));return void 0===o&&(o=s),new t.Segment(s,o).svg(i)}static points2norm(e,n){if(e.equalTo(n))throw t.Errors.ILLEGAL_PARAMETERS;return new t.Vector(e,n).normalize().rotate90CCW()}static intersectLine2Line(e,n){let i=[],[r,s,o]=e.standard,[l,a,h]=n.standard,c=r*a-s*l,f=o*a-s*h,u=r*h-o*l;if(!t.Utils.EQ_0(c)){let e=new t.Point(f/c,u/c);i.push(e)}return i}static intersectLine2Circle(e,n){let i=[],r=n.pc.projectionOn(e),s=n.pc.distanceTo(r)[0];if(t.Utils.EQ(s,n.r))i.push(r);else if(t.Utils.LT(s,n.r)){var o,l,a=Math.sqrt(n.r*n.r-s*s);o=e.norm.rotate90CCW().multiply(a),l=r.translate(o),i.push(l),o=e.norm.rotate90CW().multiply(a),l=r.translate(o),i.push(l)}return i}static intersectLine2Box(e,n){let i=[new t.Point(n.xmin,n.ymin),new t.Point(n.xmax,n.ymin),new t.Point(n.xmax,n.ymax),new t.Point(n.xmin,n.ymax)],r=[new t.Segment(i[0],i[1]),new t.Segment(i[1],i[2]),new t.Segment(i[2],i[3]),new t.Segment(i[3],i[0])],s=[];for(let t of r){let n=t.intersect(e);for(let t of n)s.push(t)}return s}static intersectLine2Arc(n,i){let r=[];if(0==e.intersectLine2Box(n,i.box).length)return r;let s=new t.Circle(i.pc,i.r),o=n.intersect(s);for(let t of o)t.on(i)&&r.push(t);return r}},t.line=((...e)=>new t.Line(...e))}},function(t,e,n){"use strict";t.exports=function(t){t.Vector=class e{constructor(...e){if(this.x=0,this.y=0,0!=e.length){if(2==e.length){let n=e[0],i=e[1];if("number"==typeof n&&"number"==typeof i)return this.x=n,void(this.y=i);if(n instanceof t.Point&&i instanceof t.Point)return this.x=i.x-n.x,void(this.y=i.y-n.y)}throw t.Errors.ILLEGAL_PARAMETERS}}clone(){return new e(this.x,this.y)}get slope(){let t=Math.atan2(this.y,this.x);return t<0&&(t=2*Math.PI+t),t}get length(){return Math.sqrt(this.dot(this))}equalTo(e){return t.Utils.EQ(this.x,e.x)&&t.Utils.EQ(this.y,e.y)}multiply(t){return new e(t*this.x,t*this.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}normalize(){if(!t.Utils.EQ_0(this.length))return new e(this.x/this.length,this.y/this.length);throw t.Errors.ZERO_DIVISION}rotate(e){let n=new t.Point(this.x,this.y).rotate(e);return new t.Vector(n.x,n.y)}rotate90CCW(){return new t.Vector(-this.y,this.x)}rotate90CW(){return new t.Vector(this.y,-this.x)}invert(){return new t.Vector(-this.x,-this.y)}},t.vector=((...e)=>new t.Vector(...e))}},function(t,e){t.exports=function(t){t.Point=class e{constructor(t=0,e=0){this.x=Number.isNaN(t)?0:t,this.y=Number.isNaN(e)?0:e}get box(){return new t.Box(this.x,this.y,this.x,this.y)}clone(){return new t.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(e){return t.Utils.EQ(this.x,e.x)&&t.Utils.EQ(this.y,e.y)}lessThan(e){return!!t.Utils.LT(this.y,e.y)||!(!t.Utils.EQ(this.y,e.y)||!t.Utils.LT(this.x,e.x))}rotate(e,n={x:0,y:0}){var i=n.x+(this.x-n.x)*Math.cos(e)-(this.y-n.y)*Math.sin(e),r=n.y+(this.x-n.x)*Math.sin(e)+(this.y-n.y)*Math.cos(e);return new t.Point(i,r)}translate(...e){if(1==e.length&&e[0]instanceof t.Vector)return new t.Point(this.x+e[0].x,this.y+e[0].y);if(2==e.length&&"number"==typeof e[0]&&"number"==typeof e[1])return new t.Point(this.x+e[0],this.y+e[1]);throw t.Errors.ILLEGAL_PARAMETERS}projectionOn(e){if(this.equalTo(e.pt))return this.clone();let n=new t.Vector(this,e.pt);if(t.Utils.EQ_0(n.cross(e.norm)))return e.pt.clone();let i=n.dot(e.norm),r=e.norm.multiply(i);return this.translate(r)}leftTo(e){let n=new t.Vector(e.pt,this);return t.Utils.GT(n.dot(e.norm),0)}distanceTo(n){let{Distance:i}=t;if(n instanceof e){let e=n.x-this.x,i=n.y-this.y;return[Math.sqrt(e*e+i*i),new t.Segment(this,n)]}return n instanceof t.Line?i.point2line(this,n):n instanceof t.Circle?i.point2circle(this,n):n instanceof t.Segment?i.point2segment(this,n):n instanceof t.Arc?i.point2arc(this,n):n instanceof t.Polygon?i.point2polygon(this,n):n instanceof t.PlanarSet?i.shape2planarSet(this,n):void 0}on(e){return e instanceof t.Point?this.equalTo(e):e instanceof t.Line?e.contains(this):e instanceof t.Circle?e.contains(this):e instanceof t.Segment?e.contains(this):e instanceof t.Arc?e.contains(this):e instanceof t.Polygon?e.contains(this):void 0}svg(t={}){let{r:e,stroke:n,strokeWidth:i,fill:r,id:s,className:o}=t,l=s&&s.length>0?`id="${s}"`:"",a=o&&o.length>0?`class="${o}"`:"";return`\n<circle cx="${this.x}" cy="${this.y}" r="${e||3}" stroke="${n||"black"}" stroke-width="${i||1}" fill="${r||"red"}" ${l} ${a} />`}},t.point=((...e)=>new t.Point(...e))}},function(t,e){t.exports=class t{constructor(t,e){this.low=t,this.high=e}get max(){return this.high}interval(e,n){return new t(e,n)}clone(){return new t(this.low,this.high)}less_than(t){return this.low<t.low||this.low==t.low&&this.high<t.high}equal_to(t){return this.low==t.low&&this.high==t.high}intersect(t){return!this.not_intersect(t)}not_intersect(t){return this.high<t.low||t.high<this.low}output(){return[this.low,this.high]}maximal_val(t,e){return Math.max(t,e)}val_less_than(t,e){return t<e}}},function(t,e,n){"use strict";let i=n(33),{RB_TREE_COLOR_RED:r,RB_TREE_COLOR_BLACK:s}=n(1);t.exports=class{constructor(t,e,n=null,r=null,o=null,l=s){this.left=n,this.right=r,this.parent=o,this.color=l,this.item={key:t,value:e},t&&t instanceof Array&&2==t.length&&(Number.isNaN(t[0])||Number.isNaN(t[1])||(this.item.key=new i(Math.min(t[0],t[1]),Math.max(t[0],t[1])))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return void 0===this.item.key&&void 0===this.item.value&&null===this.left&&null===this.right&&this.color===s}less_than(t){return this.item.key.less_than(t.item.key)}equal_to(t){let e=!0;return this.item.value&&t.item.value&&(e=this.item.value.equal_to?this.item.value.equal_to(t.item.value):this.item.value==t.item.value),this.item.key.equal_to(t.item.key)&&e}intersect(t){return this.item.key.intersect(t.item.key)}copy_data(t){this.item.key=t.item.key.clone(),this.item.value=t.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let t=this.item.key.maximal_val;this.max=t(this.max,this.right.max)}if(this.left&&this.left.max){let t=this.item.key.maximal_val;this.max=t(this.max,this.left.max)}}not_intersect_left_subtree(t){return(0,this.item.key.val_less_than)(this.left.max.high?this.left.max.high:this.left.max,t.item.key.low)}not_intersect_right_subtree(t){let e=this.item.key.val_less_than,n=this.right.max.low?this.right.max.low:this.right.item.key.low;return e(t.item.key.high,n)}}},function(t,e,n){"use strict";let i=n(0);t.exports=function(t){t.PlanarSet=class extends Set{constructor(){super(),this.index=new i}add(t){let e=this.size;if(super.add(t),this.size>e){this.index.insert(t.box,t)}return this}delete(t){let e=super.delete(t);return e&&this.index.remove(t.box,t),e}clear(){}search(t){return this.index.search(t)}hit(e){let n=new t.Box(e.x-1,e.y-1,e.x+1,e.y+1);return this.index.search(n).filter(t=>e.on(t))}svg(){return[...this].reduce((t,e)=>t+e.svg(),"")}}}},function(t,e){t.exports={ILLEGAL_PARAMETERS:new ReferenceError("Illegal Parameters"),ZERO_DIVISION:new Error("Zero division")}},function(t,e){t.exports={DP_TOL:1e-6,EQ_0:function(t){return t<1e-6&&t>-1e-6},EQ:function(t,e){return t-e<1e-6&&t-e>-1e-6},GT:(t,e)=>t-e>1e-6,GE:(t,e)=>t-e>-1e-6,LT:(t,e)=>t-e<-1e-6,LE:(t,e)=>t-e<1e-6}},function(t,e,n){"use strict";let i=n(37),r=n(36),s=new class{constructor(){this.DP_TOL=i.DP_TOL,this.CCW=!0,this.CW=!1,this.ORIENTATION={CCW:-1,CW:1,NOT_ORIENTABLE:0},this.PIx2=2*Math.PI,this.PI_2=.5*Math.PI,this.INSIDE=1,this.OUTSIDE=0,this.BOUNDARY=2,this.CONTAINS=3,this.INTERLACE=4,this.CLIP_INSIDE=1,this.CLIP_OUTSIDE=0,this.BOOLEAN_UNION=1,this.BOOLEAN_INTERSECT=2,this.BOOLEAN_SUBTRACT=3,this.OVERLAP_SAME=1,this.OVERLAP_OPPOSITE=2,this.Utils=i,this.Errors=r}};n(35)(s),n(32)(s),n(31)(s),n(30)(s),n(29)(s),n(28)(s),n(27)(s),n(26)(s),n(25)(s),n(24)(s),n(23)(s),n(22)(s),n(21)(s),n(20)(s),t.exports=s},function(t,e,n){"use strict";let i=n(38),r=n(19),{Point:s,Segment:o,Vector:l,Line:a,Box:h,Arc:c,Polygon:f,Face:u}=i,{point:p,segment:d,arc:g,vector:m}=i;class x{static offset(t,e){let n,i=e,s=[...t.edges],o=t.clone();if(0!=i)for(let t of s)n=t.isSegment()?x.offsetSegment(t.shape,i):x.offsetArc(t.shape,i),o=i>0?r.unify(o,n):r.subtract(o,n);return o}static offsetSegment(t,e){let n=Math.abs(e),r=new f,s=m(t.start,t.end).normalize(),o=s.rotate90CCW().multiply(n),l=s.rotate90CW().multiply(n),a=t.translate(o),h=t.translate(l).reverse(),c=x.arcSE(t.end,a.end,h.start,i.CW),u=x.arcSE(t.start,h.end,a.start,i.CW);return r.addFace([a,c,h,u]),r}static offsetArc(t,e){let n,s,l=Math.abs(e),a=new f,h=t.clone();h.r=t.r+l,n=x.arcStartSweep(t.end,h.end,Math.PI,t.counterClockwise),s=x.arcEndSweep(t.start,h.start,Math.PI,t.counterClockwise);let p=void 0;p=t.r>l?new c(t.pc,t.r-l,t.endAngle,t.startAngle,t.counterClockwise===i.CW?i.CCW:i.CW):new o(n.end,s.start),a.addFace([h,n,p,s]),[...a.faces][0].setArcLength();let d=u.getSelfIntersections([...a.faces][0],a.edges,!1);d=d.slice(0,d.length/2);let g,m,_=[];g=[...a.edges][1],m=[...a.edges][3];for(let t of d)r.addToIntPoints(g,t,_),r.addToIntPoints(m,t,_);let v=r.getSortedArray(_);r.splitByIntersections(a,v);let w=i.OUTSIDE;for(let t of v)t.edge_before.bv=w,t.edge_after.bv=w==i.OUTSIDE?i.INSIDE:i.OUTSIDE,w=t.edge_after.bv;let y=i.BOOLEAN_UNION;r.removeNotRelevantChains(a,y,v,!0);let E=_.length;if(E>0){let t,e;t=v[0].edge_before,e=v[E-1].edge_after,t.next=e,e.prev=t,v[0].edge_after=v[E-1].edge_after,v[E-1].edge_before=v[0].edge_before,4==E&&(t=v[2].edge_before,e=v[1].edge_after,t.next=e,e.prev=t,v[2].edge_after=v[1].edge_after,v[1].edge_before=v[2].edge_before),r.removeOldFaces(a,_),r.restoreFaces(a,_,_)}return[...a.faces][0].orientation()===i.ORIENTATION.CCW&&a.reverse(),a}static arcSE(t,e,n,r){let s=m(t,e).slope,o=m(t,n).slope;i.Utils.EQ(s,o)&&(o+=2*Math.PI,r=!0);let l=m(t,e).length;return new c(t,l,s,o,r)}static arcStartSweep(t,e,n,r){let s=m(t,e).slope,o=s+n;i.Utils.EQ(s,o)&&(o+=2*Math.PI,r=!0);let l=m(t,e).length;return new c(t,l,s,o,r)}static arcEndSweep(t,e,n,r){let{vector:s,Arc:o}=i,l=s(t,e).slope,a=l-n;return i.Utils.EQ(a,l)&&(l+=2*Math.PI,r=!0),new o(t,s(t,e).length,a,l,r)}}i.Polygon.prototype.offset=function(t){return x.offset(this,t)},t.exports=x}])});
//# sourceMappingURL=flatten-offset.umd.min.js.map